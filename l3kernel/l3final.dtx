% \iffalse meta-comment
%
%% File: l3final.dtx Copyright (C) 1990-2011 The LaTeX3 Project
%%
%% It may be distributed and/or modified under the conditions of the
%% LaTeX Project Public License (LPPL), either version 1.3c of this
%% license or (at your option) any later version.  The latest version
%% of this license is in the file
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% This file is part of the "expl3 bundle" (The Work in LPPL)
%% and all files in that bundle must be distributed together.
%%
%% The released version of this bundle is available from CTAN.
%%
%% -----------------------------------------------------------------------
%%
%% The development version of the bundle can be found at
%%
%%    http://www.latex-project.org/svnroot/experimental/trunk/
%%
%% for those people who are interested.
%%
%%%%%%%%%%%
%% NOTE: %%
%%%%%%%%%%%
%%
%%   Snapshots taken from the repository represent work in progress and may
%%   not work or may contain conflicting material!  We therefore ask
%%   people _not_ to put them into distributions, archives, etc. without
%%   prior consultation with the LaTeX3 Project.
%%
%% -----------------------------------------------------------------------
%
%<*driver|package>
\RequirePackage{l3names}
\GetIdInfo$Id$
  {L3 Experimental format finalisation}
%</driver|package>
%<*driver>
\documentclass[full]{l3doc}
\begin{document}
  \DocInput{\jobname.dtx}
\end{document}
%</driver>
% \fi
%
% \title{^^A
%   The \pkg{l3final} package\\ Format finalisation^^A
%   \thanks{This file describes v\fileversion, last revised \filedate.}^^A
% }
%
% \author{^^A
%  The \LaTeX3 Project\thanks
%    {^^A
%      E-mail:
%        \href{mailto:latex-team@latex-project.org}
%          {latex-team@latex-project.org}^^A
%    }^^A
% }
%
% \date{Released \filedate}
%
% \maketitle
%
% \begin{documentation}
%
% This module is the end of the \LaTeX3 format file. Currently, there
% is not a lot happening here.
% 
% \end{documentation}
% 
% \begin{implementation}
%
% \section{\pkg{l3final} Implementation}
%
%    \begin{macrocode}
%<*initex>
%    \end{macrocode}
%    
% \begin{macro}{\ExplSyntaxOn, \ExplSyntaxOff}
%  The idea here is that multiple \cs{ExplSyntaxOn} calls are not
%  going to mess up category codes, and that multiple calls to
%  \cs{ExplSyntaxOff} are also not wasting time. These are described in
%  \pkg{l3bootstrap} (as they are needed earlier by the package).
%    \begin{macrocode}
\cs_new_protected_nopar:Npn \ExplSyntaxOn {
  \bool_if:NF \l_expl_status_bool
    {
      \cs_set_protected_nopar:Npx \ExplSyntaxOff
        {
          \char_set_catcode:nn { 9 }   { \char_value_catcode:n { 9 } }
          \char_set_catcode:nn { 32 }  { \char_value_catcode:n { 32 } }
          \char_set_catcode:nn { 34 }  { \char_value_catcode:n { 34 } }
          \char_set_catcode:nn { 38 }  { \char_value_catcode:n { 38 } }
          \char_set_catcode:nn { 58 }  { \char_value_catcode:n { 58 } }
          \char_set_catcode:nn { 94 }  { \char_value_catcode:n { 94 } }
          \char_set_catcode:nn { 95 }  { \char_value_catcode:n { 95 } }
          \char_set_catcode:nn { 124 } { \char_value_catcode:n { 124 } }
          \char_set_catcode:nn { 126 } { \char_value_catcode:n { 126 } }
          \tex_endlinechar:D = 
            \tex_the:D \tex_endlinechar:D \scan_stop:
          \bool_set_false:N \l_expl_status_bool
          \cs_set_protected_nopar:Npn \ExplSyntaxOff { }
        }
    }
  \char_make_ignore:n           { 9 }   % tab
  \char_make_ignore:n           { 32 }  % space
  \char_make_other:n            { 34 }  % double quote
  \char_make_alignment:n        { 38 }  % ampersand
  \char_make_letter:n           { 58 }  % colon
  \char_make_math_superscript:n { 94 }  % circumflex
  \char_make_letter:n           { 95 }  % underscore
  \char_make_other:n            { 124 } % pipe
  \char_make_space:n            { 126 } % tilde  
  \tex_endlinechar:D = 32 \scan_stop:
  \bool_set_true:N \l_expl_status_bool
}
\cs_new_protected_nopar:Npn \ExplSyntaxOff { }
%    \end{macrocode}
% \end{macro}
%
% \begin{variable}{\l_expl_status_bool}
%   A flag to show the current syntax status. 
%    \begin{macrocode}
\bool_new:N \l_expl_status_bool
%    \end{macrocode}
%\ end{variable}
%
% \begin{macro}{\par}
%   \TeX{} has a nasty habit of inserting a command with the name \cs{par}
%   so we had better make sure that that command at least has a definition.
%    \begin{macrocode}
\cs_set_eq:NN \par \tex_par:D
%    \end{macrocode}
% \end{macro}
%
% The very last job is to dump the format, taking care to first leave
% the code environment.
%    \begin{macrocode}
\use:n
  {
    \char_make_space:n          { 9 }
    \char_make_space:n          { 32 }
    \char_make_math_subscript:n { 94 }
    \char_make_other:n          { 58 }
    \char_make_active:n         { 126 }
    \tex_endlinechar:D = 13 \scan_stop:
    \tex_dump:D
  }
%    \end{macrocode}
%
%    \begin{macrocode}
%</initex>
%    \end{macrocode}
%
% \end{implementation}
%
%\PrintIndex
