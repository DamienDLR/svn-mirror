
# Feb 2009
# Will: I'm messing around in here a bit to work out how Makefiles behave.
#       I think we need to add some of this stuff to the "official" Makefile.
#
# I notice that the source3 on CTAN is compiled as [full]; i.e., it contains
# the implementation as well as documentation for the complete sources.
# 
# Is that something that we want to continue, or do we want to keep
# it (as now with `make sourcedoc`) to only include the documentation of 
# each module?
#
# Could then include the typeset module DTX files including both documentation
# and implementation and index for each one.
#
# Pro: source3 can be kept as more of a "reference manual" that doesn't
#      include `unnecessary' implementation details (the way they interrupt
#      each chapter is a little intrusive; it would be a different story
#      if we could split up the DTX files as they're input so all the 
#      documentation comes together at the beginning and all the 
#      implementation comes together at the end).
#
# Con: No "master index" covering the entire expl3 kernel. Users must consult
#      individual module PDF files to read the implementation/index.
#
# An alternative: distribute both source3.pdf (with implementation) 
#                 and reference3.pdf (without implementation).


DTX = \
	expl3.dtx \
	l3alloc.dtx \
	l3basics.dtx \
	l3box.dtx \
	l3calc.dtx \
	l3chk.dtx \
	l3clist.dtx \
	l3doc.dtx \
	l3expan.dtx \
	l3final.dtx \
	l3int.dtx \
	l3io.dtx \
	l3keyval.dtx \
	l3messages.dtx \
	l3msg.dtx \
	l3names.dtx \
	l3num.dtx \
	l3precom.dtx \
	l3prg.dtx \
	l3prop.dtx \
	l3quark.dtx \
	l3seq.dtx \
	l3skip.dtx \
	l3tl.dtx \
	l3token.dtx \
	l3toks.dtx \
	l3vers.dtx \
	l3xref.dtx

STY = \
	expl3.sty \
	l3basics.sty \
	l3box.sty \
	l3calc.sty \
	l3chk.sty \
	l3clist.sty \
	l3expan.sty \
	l3int.sty \
	l3io.sty \
	l3keyval.sty \
	l3messages.sty \
	l3msg.sty \
	l3names.sty \
	l3num.sty \
	l3precom.sty \
	l3prg.sty \
	l3prop.sty \
	l3quark.sty \
	l3seq.sty \
	l3skip.sty \
	l3tl.sty \
	l3token.sty \
	l3toks.sty \
	l3xref.sty

CLS = l3doc.cls

INS = \
	l3.ins \
	l3format.ins

TEST = \
	test1.tex \
	test2.tex \
	test3.tex

DUMPS = \
	test1.dmp \
	test2.dmp \
	test3.dmp \
	testdump.cmp

README = readme.txt

DOCS = source3.tex

PDFS = \
	source3.pdf \
	expl3.pdf \
	l3basics.pdf \
	l3box.pdf \
	l3calc.pdf \
	l3chk.pdf \
	l3clist.pdf \
	l3doc.pdf \
	l3expan.pdf \
	l3int.pdf \
	l3io.pdf \
	l3keyval.pdf \
	l3messages.pdf \
	l3names.pdf \
	l3num.pdf \
	l3precom.pdf \
	l3prg.pdf \
	l3prop.pdf \
	l3quark.pdf \
	l3seq.pdf \
	l3skip.pdf \
	l3tl.pdf \
	l3token.pdf \
	l3toks.pdf \
	l3xref.pdf


all: distrib-ctan

tds-dirs:
	mkdir -p ../../distrib/expl3-tds/doc/latex/expl3
	mkdir -p ../../distrib/expl3-tds/source/latex/expl3
	mkdir -p ../../distrib/expl3-tds/tex/latex/expl3
	mkdir -p ../../distrib/expl3
	rm -f ../../distrib/expl3-tds/doc/latex/expl3/*
	rm -f ../../distrib/expl3-tds/source/latex/expl3/*
	rm -f ../../distrib/expl3-tds/tex/latex/expl3/*
	rm -f ../../distrib/expl3/*
	rm -f ../../distrib/expl3.tds.zip
	rm -f ../../distrib/expl3.zip

distrib-pdf:
	make alldoc

distrib-tds: tds-dirs distrib-pdf
	latex l3.ins
	tex l3doc.dtx
	cp $(DOCS) $(DTX) $(INS) $(TEST) \
	   ../../distrib/expl3-tds/source/latex/expl3
	cp  $(README) $(PDFS) ../../distrib/expl3-tds/doc/latex/expl3
	cp $(STY) $(CLS) ../../distrib/expl3-tds/tex/latex/expl3
	rm $(STY) l3doc.cls l3xref-test.tex
	cd ../../distrib/expl3-tds ; \
	zip -r ../expl3.tds.zip *

distrib-ctan: distrib-tds
	cp $(DOCS) $(DTX) $(INS) $(TEST) $(PDFS) $(README) ../../distrib/expl3
	cd ../../distrib/ ; \
	zip -r expl3.zip expl3 expl3.tds.zip
