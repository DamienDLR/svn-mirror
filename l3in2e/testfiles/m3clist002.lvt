%
% Copyright (C) 2008 The LaTeX Project
% 
\documentclass{minimal}
\input{regression-test}

\RequirePackage{expl3}


\begin{document}
\START
\AUTHOR{Will Robertson}
\ExplSyntaxOn

\tl_clear:N \l_tmpa_tl
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{creation}{
  {  
    \clist_new:N \l_a_clist
    \clist_new:N \g_b_clist
  }
  \TYPE { Empty~-\clist_use:N \l_a_clist- }
  \TYPE { Empty~-\clist_use:N \g_b_clist- }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{clearing}{
  \clist_put_left:Nn \l_a_clist { test~ a }
  \clist_put_left:Nn \g_b_clist { test~ b }
  {
    \clist_clear:N \l_a_clist
    \clist_gclear:N \g_b_clist
    \TYPE { \tex_meaning:D \l_a_clist }
  }
  \TYPE { \tex_meaning:D \l_a_clist }
  \TYPE { \tex_meaning:D \g_b_clist }
  \SEPARATOR
  {
    \TYPE { \tex_meaning:D \l_undefined_clist }
    \TYPE { \tex_meaning:D \g_undefined_clist }
    \clist_clear:N \l_undefined_clist
    \clist_clear:N \g_undefined_clist
    \TYPE { \tex_meaning:D \l_undefined_clist }
    \TYPE { \tex_meaning:D \g_undefined_clist }
  }
  \TYPE { \tex_meaning:D \l_undefined_clist }
  \TYPE { \tex_meaning:D \g_undefined_clist }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{clear_new}{
  \clist_put_left:Nn \l_a_clist { test~ a }
  \clist_put_left:Nn \g_b_clist { test~ b }
  {
    \clist_clear_new:N  \l_a_clist 
    \clist_clear_new:N  \l_c_clist % previously undefined
    \clist_gclear_new:N \g_b_clist
    \clist_gclear_new:N \g_d_clist % previously undefined
    \TYPE { \tex_meaning:D \l_a_clist }
    \TYPE { \tex_meaning:D \l_c_clist }
  }
  \TYPE { \tex_meaning:D \l_a_clist }
  \TYPE { \tex_meaning:D \l_c_clist }% STILL UNDEFINED?!
  \TYPE { \tex_meaning:D \g_b_clist }
  \TYPE { \tex_meaning:D \g_d_clist }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{(g)set_eq}{
  \clist_clear:N \l_tmpa_clist
  \clist_clear:N \l_a_clist
  \clist_put_left:Nn \l_tmpa_clist { abc }
  {
    \clist_set_eq:NN  \l_a_clist  \l_tmpa_clist
    \clist_set_eq:NN  \l_e_clist  \l_tmpa_clist % previously undefined
    \clist_gset_eq:NN \g_b_clist  \l_tmpa_clist
    \clist_gset_eq:NN \g_f_clist  \l_tmpa_clist % previously undefined
    \TYPE{ \tex_meaning:D \l_tmpa_clist }
    \TYPE{ \tex_meaning:D \l_e_clist    }
    \TYPE{ \tex_meaning:D \l_a_clist    }
    \SEPARATOR
  }    
  \TYPE{ \tex_meaning:D \l_tmpa_clist }
  \TYPE{ \tex_meaning:D \l_e_clist    }
  \TYPE{ \tex_meaning:D \l_a_clist    }
  \SEPARATOR
  \TYPE{ \tex_meaning:D \l_tmpa_clist }
  \TYPE{ \tex_meaning:D \g_f_clist    }
  \TYPE{ \tex_meaning:D \g_b_clist    }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{concat}{
  {
    \clist_clear:N     \l_tmpa_clist
    \clist_put_left:Nn \l_tmpa_clist {}
    \clist_put_left:Nn \l_tmpa_clist {def}
    \clist_put_left:Nn \l_tmpa_clist {abc}
    \clist_put_left:Nn \l_a_clist    {xyz}
    \clist_put_left:Nn \l_a_clist    {uvw}
    \clist_concat:NNN \l_c_clist \l_tmpa_clist \l_a_clist
    \TYPE{ \tex_meaning:D \l_c_clist }
  }
  \TYPE{ \tex_meaning:D \l_c_clist }
  \SEPARATOR
  \clist_clear:c {l_a_clist}
  \clist_clear:c {l_tmpa_clist}
  {
    \clist_put_left:cn {l_tmpa_clist} {DEF}
    \clist_put_left:cn {l_tmpa_clist} {ABC}
    \clist_put_left:cn {l_a_clist}    {XYZ}
    \clist_put_left:cn {l_a_clist}    {UVW}
    \clist_concat:ccc  {l_c_clist} {l_tmpa_clist} {l_a_clist}
    \TYPE{ \tex_meaning:D \l_c_clist }
  }
  \TYPE{ \tex_meaning:D \l_c_clist }
}


\TEST{gconcat}{
  {
    \clist_clear:N     \l_tmpa_clist
    \clist_put_left:Nn \l_tmpa_clist {}
    \clist_put_left:Nn \l_tmpa_clist {def}
    \clist_put_left:Nn \l_tmpa_clist {abc}
    \clist_put_left:Nn \l_a_clist    {xyz}
    \clist_put_left:Nn \l_a_clist    {uvw}
    \clist_gconcat:NNN \g_b_clist \l_tmpa_clist \l_a_clist
  }
  \TYPE{ \tex_meaning:D \g_b_clist }
  \SEPARATOR
  \clist_clear:c {g_b_clist}
  \clist_clear:c {l_tmpa_clist}
  \clist_clear:c {l_a_clist}
  {
    \clist_put_left:cn {l_tmpa_clist} {DEF}
    \clist_put_left:cn {l_tmpa_clist} {ABC}
    \clist_put_left:cn {l_a_clist}    {XYZ}
    \clist_put_left:cn {l_a_clist}    {UVW}
    \clist_gconcat:ccc  {g_b_clist} {l_tmpa_clist} {l_a_clist}
  }
  \TYPE{ \tex_meaning:D \g_b_clist }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{put~left}{
  \clist_clear:N \l_tmpa_clist
  \tl_set:Nn  \l_tmpa_tl { \l_tmpb_tl }
  \tl_set:Nn  \l_tmpb_tl { \l_tmpc_tl }
  \tl_set:Nn  \l_tmpc_tl { FULL~EXPANSION }
  \clist_put_left:Nn \l_tmpa_clist  { \ERROR A    \par }
  \clist_put_left:No \l_tmpa_clist  { \l_tmpa_tl \par }
  \clist_put_left:Nx \l_tmpa_clist  { \l_tmpa_tl \par }
  \clist_put_left:cn {l_tmpa_clist} { \ERROR B    \par }
  \clist_put_left:co {l_tmpa_clist} { \l_tmpb_tl \par }
  \clist_display:N \l_tmpa_clist 
}

\TEST{put~right}{
  \clist_clear:N \l_tmpa_clist
  \tl_set:Nn  \l_tmpa_tl { \l_tmpb_tl }
  \tl_set:Nn  \l_tmpb_tl { \l_tmpc_tl }
  \tl_set:Nn  \l_tmpc_tl { FULL~EXPANSION }
  \clist_put_right:Nn \l_tmpa_clist  { \ERROR A    \par }
  \clist_put_right:No \l_tmpa_clist  { \l_tmpa_tl \par }
  \clist_put_right:Nx \l_tmpa_clist  { \l_tmpa_tl \par }
  \clist_put_right:cn {l_tmpa_clist} { \ERROR B    \par }
  \clist_put_right:co {l_tmpa_clist} { \l_tmpb_tl \par }
  \clist_display:N \l_tmpa_clist 
}

\TEST{gput~left}{
  \clist_clear:N \g_b_clist
  \tl_set:Nn  \l_tmpa_tl { \l_tmpb_tl }
  \tl_set:Nn  \l_tmpb_tl { \l_tmpc_tl }
  \tl_set:Nn  \l_tmpc_tl { FULL~EXPANSION }
  {
    \clist_gput_left:Nn \g_b_clist  { \ERROR A    \par }
    \clist_gput_left:No \g_b_clist  { \l_tmpa_tl \par }
    \clist_gput_left:Nx \g_b_clist  { \l_tmpa_tl \par }
    \clist_gput_left:cn {g_b_clist} { \ERROR B    \par }
    \clist_gput_left:co {g_b_clist} { \l_tmpb_tl \par }
  }
  \clist_display:N \g_b_clist 
}

\TEST{gput~right}{
  \clist_clear:N \g_b_clist
  \tl_set:Nn  \l_tmpa_tl { \l_tmpb_tl }
  \tl_set:Nn  \l_tmpb_tl { \l_tmpc_tl }
  \tl_set:Nn  \l_tmpc_tl { FULL~EXPANSION }
  {
    \clist_gput_right:Nn \g_b_clist  { \ERROR A    \par }
    \clist_gput_right:No \g_b_clist  { \l_tmpa_tl \par }
    \clist_gput_right:Nx \g_b_clist  { \l_tmpa_tl \par }
    \clist_gput_right:cn {g_b_clist} { \ERROR B    \par }
    \clist_gput_right:co {g_b_clist} { \l_tmpb_tl \par }
  }
  \clist_display:N \g_b_clist 
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{if_empty~(expect~Y/Y/N~NB.~different~than~seq!!)}{
  \clist_clear:N      \l_tmpa_clist
  \clist_if_empty:NTF \l_tmpa_clist {\YES}{\NO}
  \clist_put_left:Nn  \l_tmpa_clist {}
  \clist_if_empty:NTF \l_tmpa_clist {\YES}{\NO}
  \clist_clear:N      \l_tmpa_clist
  \clist_put_left:Nn  \l_tmpa_clist {x}
  \clist_if_empty:NTF \l_tmpa_clist {\YES}{\NO}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clist_clear:N \l_tmpa_clist
\clist_push:Nn \l_tmpa_clist {a\par}
\clist_push:Nn \l_tmpa_clist {b\par}
\clist_push:Nn \l_tmpa_clist {ZZZ}
\clist_push:Nn \l_tmpa_clist {}
\clist_push:Nn \l_tmpa_clist {~}
\clist_push:Nn \l_tmpa_clist {\par}
\clist_push:Nn \l_tmpa_clist {\ERROR}
  
\TEST{if_in~(expect~2~first~false)}{
  \clist_if_in:NnTF \l_tmpa_clist {a}      {\ERROR} {\FALSE}
  \clist_if_in:NnTF \l_tmpa_clist {ZZ}     {\ERROR} {\FALSE}
  \clist_if_in:NnTF \l_tmpa_clist {a\par}  {\TRUE}  {\ERROR}
  \clist_if_in:NnTF \l_tmpa_clist {~}      {\TRUE}  {\ERROR}
  \clist_if_in:NnTF \l_tmpa_clist {\par}   {\TRUE}  {\ERROR}
  \clist_if_in:NnTF \l_tmpa_clist {\ERROR} {\TRUE}  {\ERROR}
}

\TEST{if_in~with~empty~(check~this~behaviour)}{
  \clist_if_in:NnTF \l_tmpa_clist {}       {\TRUE}  {\FALSE}
}

\TEST{if_in~(T)}{
  \clist_if_in:NnT \l_tmpa_clist {a\par}  {\TRUE} 
  \clist_if_in:NnT \l_tmpa_clist {~}      {\TRUE} 
  \clist_if_in:NnT \l_tmpa_clist {\par}   {\TRUE} 
  \clist_if_in:NnT \l_tmpa_clist {\ERROR} {\TRUE} 
}

\TEST{if_in~(F)}{
  \clist_if_in:NnF \l_tmpa_clist {a}     {\FALSE}
  \clist_if_in:NnF \l_tmpa_clist {ZZ}    {\FALSE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clist_clear:N \l_tmpa_clist
\clist_push:Nn \l_tmpa_clist {a}
\clist_push:Nn \l_tmpa_clist {b\par}
\clist_push:Nn \l_tmpa_clist {c}
  
\TEST{map_inline}{
  \clist_map_inline:Nn \l_tmpa_clist  { \exp_args:No \TYPE {\tl_to_str:n{#1}} }
  \clist_map_inline:cn {l_tmpa_clist} { \exp_args:No \TYPE {\tl_to_str:n{#1}} }
  \clist_map_inline:nn {aa,bb\par,cc} { \exp_args:No \TYPE {\tl_to_str:n{#1}} }
}

\TEST{map_function}{
  \cs_set:Npn \MAP:n #1 { \exp_args:No \TYPE {\tl_to_str:n{#1}} }
  \clist_map_function:NN \l_tmpa_clist  \MAP:n
  \clist_map_function:cN {l_tmpa_clist} \MAP:n
  \clist_map_function:nN {aa,bb\par,cc} \MAP:n
}

\TEST{map_variable}{
  \clist_map_variable:NNn \l_tmpa_clist  \l_tmpa_tl { 
    \exp_args:No \TYPE { \tl_to_str:N \l_tmpa_tl } 
  }
  \clist_map_variable:cNn {l_tmpa_clist} \l_tmpa_tl { 
    \exp_args:No \TYPE { \tl_to_str:N \l_tmpa_tl } 
  }
  \clist_map_variable:nNn {aa,bb\par,cc} \l_tmpa_tl { 
    \exp_args:No \TYPE { \tl_to_str:N \l_tmpa_tl } 
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{remove_duplicates}{
  \clist_clear:N \l_tmpa_clist
  \clist_push:Nn \l_tmpa_clist {a\par}
  \clist_push:Nn \l_tmpa_clist {b\par}
  \clist_push:Nn \l_tmpa_clist {c\par}
  \clist_push:Nn \l_tmpa_clist {a\par}
  \clist_push:Nn \l_tmpa_clist {c\par}
  \clist_push:Nn \l_tmpa_clist {b\par}
  {
    \clist_remove_duplicates:N \l_tmpa_clist
    \TYPE{ \clist_use:N \l_tmpa_clist }
  }
  \TYPE{ \clist_use:N \l_tmpa_clist }
  {
    \clist_gremove_duplicates:N \l_tmpa_clist
    \TYPE{ \clist_use:N \l_tmpa_clist }
  }
  \TYPE{ \clist_use:N \l_tmpa_clist }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%       
% PENDING ADDITION TO EXPL3: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%       
%
% \clist_clear:N \l_tmpa_clist
% \clist_clear:N \g_tmpa_clist
% \seq_clear:N \l_tmpa_seq
% 
% \seq_push:Nn \l_tmpa_seq {a}
% \seq_push:Nn \l_tmpa_seq {\par\foo}
% \seq_push:Nn \l_tmpa_seq {e}
%   
% \TEST{set_from_seq}{
%   \group_begin:
%     \clist_set_from_seq:NN \l_tmpa_clist \l_tmpa_seq
%     \clist_gset_from_seq:NN \g_tmpa_clist \l_tmpa_seq
%     \TYPE { \meaning \l_tmpa_clist }
%     \TYPE { \meaning \g_tmpa_clist }
%   \group_end:
%   \TYPE { \meaning \l_tmpa_clist }
%   \TYPE { \meaning \g_tmpa_clist }
% }
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    

\END
