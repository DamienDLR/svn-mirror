%
% Copyright (C) 2008 LaTeX3 Project
% 
\documentclass{minimal}
\input{regression-test}

\RequirePackage{l3tlp}

\begin{document}
\START
\AUTHOR{Will~Robertson}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TESTEXP{to_str}{
  \tlist_to_str:n { abc } \NEWLINE
  \tlist_to_str:n { \ERROR } \NEWLINE
  \tlist_to_str:n { # }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{if_eq}{
  \tlist_if_eq:nnTF {}{}               {\TRUE}{\FALSE}
  \tlist_if_eq:nnTF {~}{~~}            {\TRUE}{\FALSE}
  \tlist_if_eq:nnTF {abc}{abc}         {\TRUE}{\FALSE}
  \tlist_if_eq:nnTF {abc}{abc~}        {\TRUE}{\FALSE}
  \tlist_if_eq:nnTF {abc#}{abc#}       {\TRUE}{\FALSE}
  \tlist_if_eq:nnTF {abc\par}{abc\par} {\TRUE}{\FALSE}
  \SEPARATOR
  \tlist_if_eq:nnTF {}{}               {\TRUE}
  \tlist_if_eq:nnTF {~}{~~}            {\TRUE}
  \tlist_if_eq:nnT  {abc}{abc}         {\TRUE}
  \tlist_if_eq:nnT  {abc#}{abc#}       {\TRUE}
  \tlist_if_eq:nnT  {abc\par}{abc\par} {\TRUE}
  \SEPARATOR
  \tlist_if_eq:nnF  {abc}{abc~}               {\FALSE}
  \SEPARATOR
  \tlist_if_eq:nnTF {}{}               {\FALSE}{\TRUE}
  \tlist_if_eq:nnTF {~}{~~}            {\FALSE}{\TRUE}
  \tlist_if_eq:nnTF {abc}{abc}         {\FALSE}{\TRUE}
  \tlist_if_eq:nnTF {abc}{abc~}        {\FALSE}{\TRUE}
  \tlist_if_eq:nnTF {abc#}{abc#}       {\FALSE}{\TRUE}
  \tlist_if_eq:nnTF {abc\par}{abc\par} {\FALSE}{\TRUE}
}

\OMIT
\tlp_set:Nn \l_tmpa_tlp {a}
\tlp_set:Nn \l_tmpb_tlp {\l_tmpa_tlp}
\tlp_set:Nn \l_tmpc_tlp {\l_tmpb_tlp}
\tlp_set:Nn \l_tmpd_tlp {\l_tmpc_tlp}
\tlp_set:Nn \l_tmpe_tlp {a}
\TIMO

\TEST{if_eq~variants}{
  \tlist_if_eq:noTF {ab}{\l_tmpa_tlp b} {\TRUE}{\FALSE}
  \tlist_if_eq:noT  {ab}{\l_tmpa_tlp b} {\TRUE}
  \tlist_if_eq:noF  {ab}{\l_tmpa_tlp Z} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:onTF {\l_tmpa_tlp b}{ab} {\TRUE}{\FALSE}
  \tlist_if_eq:onT  {\l_tmpa_tlp b}{ab} {\TRUE}
  \tlist_if_eq:onF  {\l_tmpa_tlp Z}{ab} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:oxTF {\l_tmpa_tlp}{\l_tmpd_tlp}   {\TRUE}{\FALSE}
  \tlist_if_eq:oxT  {\l_tmpa_tlp}{\l_tmpd_tlp}   {\TRUE}
  \tlist_if_eq:oxF  {\l_tmpa_tlp}{\l_tmpd_tlp Z} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:xoTF {\l_tmpd_tlp}  {\l_tmpa_tlp} {\TRUE}{\FALSE}
  \tlist_if_eq:xoT  {\l_tmpd_tlp}  {\l_tmpa_tlp} {\TRUE}
  \tlist_if_eq:xoF  {\l_tmpd_tlp Z}{\l_tmpa_tlp} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:xxTF {\l_tmpd_tlp}{\l_tmpc_tlp}   {\TRUE}{\FALSE}
  \tlist_if_eq:xxT  {\l_tmpd_tlp}{\l_tmpc_tlp}   {\TRUE}
  \tlist_if_eq:xxF  {\l_tmpd_tlp}{\l_tmpc_tlp Z} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:nxTF {ab}{\l_tmpc_tlp b} {\TRUE}{\FALSE}
  \tlist_if_eq:xnT  {\l_tmpd_tlp b}{ab} {\TRUE}
  \tlist_if_eq:nxF  {ab}{\l_tmpc_tlp Z} {\FALSE}
  \SEPARATOR
  \tlist_if_eq:ooTF {\l_tmpa_tlp b}{\l_tmpe_tlp b} {\TRUE}{\FALSE}
  \tlist_if_eq:ooT  {\l_tmpa_tlp b}{\l_tmpe_tlp b} {\TRUE}
  \tlist_if_eq:ooF  {\l_tmpa_tlp b}{\l_tmpe_tlp Z} {\FALSE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tlp_set:Nn \l_tmpa_tlp {}
\tlp_set:Nn \l_tmpb_tlp {~}
\tlp_set:Nn \l_tmpc_tlp {X}
\TESTEXP{if_empty~(expect~T/F/F~repeated)}{
  \tlist_if_empty_p:n { }~
  \tlist_if_empty_p:n {~}~
  \tlist_if_empty_p:n {X}\NEWLINE
  \tlist_if_empty:nTF { } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_empty:nTF {~} {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_empty:nTF {X} {\TRUE}{\FALSE} \NEWLINE
  \NEWLINE
  \tlist_if_empty_p:o { \l_tmpa_tlp }~
  \tlist_if_empty_p:o { \l_tmpb_tlp }~
  \tlist_if_empty_p:o { \l_tmpc_tlp }\NEWLINE
  \tlist_if_empty:oTF { \l_tmpa_tlp } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_empty:oTF { \l_tmpb_tlp } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_empty:oTF { \l_tmpc_tlp } {\TRUE}{\FALSE} \NEWLINE
}

\TESTEXP{if_blank~(expect~T/T/F~repeated)}{
  \tlist_if_blank_p:n { }~
  \tlist_if_blank_p:n {~}~
  \tlist_if_blank_p:n {X}\NEWLINE
  \tlist_if_blank:nTF { } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_blank:nTF {~} {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_blank:nTF {X} {\TRUE}{\FALSE} \NEWLINE
  \NEWLINE
  \tlist_if_blank_p:o { \l_tmpa_tlp }~
  \tlist_if_blank_p:o { \l_tmpb_tlp }~
  \tlist_if_blank_p:o { \l_tmpc_tlp }\NEWLINE
  \tlist_if_blank:oTF { \l_tmpa_tlp } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_blank:oTF { \l_tmpb_tlp } {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_blank:oTF { \l_tmpc_tlp } {\TRUE}{\FALSE} \NEWLINE
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{if_in}{
  \tlist_if_in:nnTF {123abc\par}  {abc\par} {\TRUE}{\FALSE}
  \tlist_if_in:nnTF {123ab~cdef} {ab~c}     {\TRUE}{\FALSE}
  \SEPARATOR
  \tlp_set:Nn \l_tmpa_tlp { abc~{abc}~abc }
  \tlist_if_in:onTF {\l_tmpa_tlp}  {abc~} {\TRUE}{\FALSE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tlp_set:Nn \l_tmpa_tlp { abc~{abc}~abc }
\TESTEXP{Reversing~(TLIST)}{
  \tlist_reverse:n { abc~{abc}~abc } \NEWLINE
  \tlist_reverse:o { \l_tmpa_tlp }
}  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tlp_set:Nn \l_tmpa_tlp { 123456789 }
\tlp_set:Nn \l_tmpb_tlp { 1234~6789 }
\tlp_set:Nn \l_tmpc_tlp { 1234{abcdef}6789 }
\TESTEXP{elt_count}{
  \tlist_elt_count:n { 123456789 } \NEWLINE
  \tlist_elt_count:n { 1234~6789 } \NEWLINE
  \tlist_elt_count:n { 1234{abcdef}6789 } \NEWLINE
  \tlist_elt_count:o { \l_tmpa_tlp } \NEWLINE
  \tlist_elt_count:o { \l_tmpb_tlp } \NEWLINE
  \tlist_elt_count:o { \l_tmpc_tlp }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{to_lowercase/uppercase}{
  \tlist_to_lowercase:n { \TYPE {ABC} }
  \tlist_to_lowercase:n { \TYPE {A{B}C} }
  \tlist_to_uppercase:n { \TYPE {abc} }
  \tlist_to_uppercase:n { \TYPE {a{b}c} }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tlp_set:Nn \l_tmpa_tlp { \l_tmpb_tlp }
\tlp_set:Nn \l_tmpb_tlp { \l_tmpc_tlp }
\tlp_set:Nn \l_tmpc_tlp { a b c x y z }
\TESTEXP{heads/tails}{
  % I'm not worrying about the :w versions
  % because they're used internally.
  \tlist_head:n   { a \ERROR }~
  \tlist_head_i:n { a \ERROR }~
  \tlist_tail:n { \ERROR z }~
  \tlist_tail:f { \l_tmpa_tlp }~
  \NEWLINE
  \tlist_head_iii:n { abcdef }~
  \tlist_head_iii:f { \l_tmpc_tlp }
}

\TESTEXP{heads/tails~broken}{
  % I'm not worrying about the :w versions
  % because they're used internally.
  -\tlist_head:n   { }-~
  \NEWLINE
  \tlist_head_iii:n { a }~
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cs_set:Npn \tlist_tmp:w #1 {[#1]~}
\TESTEXP{map_function}{
  \tlist_map_function:nN {abc{{A}B}C} \tlist_tmp:w
  \tlist_map_function:nN {abc{{A}B}C} {\tlist_tmp:w}
}

\TEST{map_inline}{
  \tlist_map_inline:nn {abc{{A}B}C} {\TYPE{[#1]}}
}

\TEST{map_variable}{
  \tlist_map_variable:nNn {ab{c{A}B}C} \ii {
    \TYPE{[\ii]~}
  }
}

\TEST{map_break~inline/variable}{
  \tlist_map_inline:nn {abc\ERROR} {
    \tlist_if_eq:nnTF {#1} {c} {
      \tlist_map_break:w
    }{
      \TYPE{[#1]}    
    }
  }  
  \SEPARATOR
  \tlist_map_variable:nNn {abc\ERROR} \ii {
    \tlist_if_eq:noTF {c} {\ii} {
      \tlist_map_break:w
    }{
      \TYPE{[\ii]}    
    }
  }
}

\cs_set:Npn \tlist_tmp:w #1 {    
  \tlist_if_eq:nnTF {#1} {c} {
    \tlist_map_break:w
  }{
    \TYPE{[#1]}    
  }
}
\TESTEXP{map_break~function}{
  \tlist_map_function:nN {a{b}c\ERROR} {\tlist_tmp:w}  
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begingroup
\catcode`\a=12
\gdef\Aother{a}
\endgroup

\TESTEXP{head_eq_meaning}{
  \tlist_if_head_eq_meaning_p:nN {abc} a \NEWLINE
  \tlist_if_head_eq_meaning:nNTF {abc} a  {\TRUE}{\FALSE} \NEWLINE
  \exp_args:Nno \tlist_if_head_eq_meaning:nNF {abc} \Aother  {\FALSE} \NEWLINE
  \tlist_if_head_eq_meaning:nNT  {~abc} a {\TRUE} \NEWLINE
  \tlist_if_head_eq_meaning:nNTF {\ERROR\ERROR} \ERROR {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_head_eq_meaning:nNTF {###} # {\TRUE}{\FALSE} \NEWLINE
}

\TESTEXP{head_eq_charcode:nN}{
  \tlist_if_head_eq_charcode_p:nN {abc} a \NEWLINE
  \tlist_if_head_eq_charcode:nNTF {abc} a  {\TRUE}{\FALSE} \NEWLINE
  \exp_args:Nno \tlist_if_head_eq_charcode:nNT {abc} \Aother  {\TRUE} \NEWLINE
  \exp_args:Nno \tlist_if_head_eq_charcode:nNF {abc} B  {\FALSE} \NEWLINE
  \tlist_if_head_eq_charcode:nNT  {~abc} a {\TRUE} \NEWLINE
  \tlist_if_head_eq_charcode:nNTF {\ERROR\ERROR} \ERROR {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_head_eq_charcode:nNTF {###} # {\TRUE}{\FALSE} \NEWLINE
}

\OMIT
\tlp_set:Nn \l_tmpa_tlp {abc}
\tlp_set:Nn \l_tmpb_tlp {\l_tmpa_tlp}
\tlp_set:Nn \l_tmpc_tlp {~howdy}
\tlp_set:Nn \l_tmpd_tlp {\exp_stop_f: \ERROR\ERROR}
\tlp_set:Nn \l_tmpe_tlp {##}
\TIMO

\TESTEXP{head_eq_charcode:fN}{
  \tlist_if_head_eq_charcode_p:fN {\l_tmpa_tlp} a \NEWLINE
  \tlist_if_head_eq_charcode:fNTF {\l_tmpb_tlp} a {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_head_eq_charcode:fNT  {\l_tmpd_tlp} \ERROR {\TRUE} \NEWLINE
  \tlist_if_head_eq_charcode:fNF  {\l_tmpe_tlp} $ {\FALSE} \NEWLINE
}

\TESTEXP{head_eq_catcode}{
  \tlist_if_head_eq_catcode_p:nN {abc} a \NEWLINE
  \tlist_if_head_eq_catcode:nNTF {abc} a  {\TRUE}{\FALSE} \NEWLINE
  \exp_args:Nno \tlist_if_head_eq_catcode:nNF {abc} \Aother  {\FALSE} \NEWLINE
  \tlist_if_head_eq_catcode:nNT  {~abc} a {\TRUE} \NEWLINE
  \tlist_if_head_eq_catcode:nNTF {\ERROR\ERROR} \ERROR {\TRUE}{\FALSE} \NEWLINE
  \tlist_if_head_eq_catcode:nNTF {###} # {\TRUE}{\FALSE} \NEWLINE
}

\END

