%
% Copyright (C) 2008 LaTeX3 Project
% 

\documentclass{article}
\input{regression-test}

\RequirePackage{l3xref}
\ExplSyntaxOn


\cs_set_nopar:Npn \startrecording {\iow_open:Nn \xref_write {\jobname.xref}}
\cs_set_nopar:Npn \DefineCrossReferences {
  \group_begin:
    \ExplSyntaxNamesOn
    \InputIfFileExists{\jobname.xref}{}{}
  \group_end:
}
\AtBeginDocument{\DefineCrossReferences\startrecording}

\xref_new:nn {name}{}
\cs_set_nopar:Npn \setname{\tlp_set:Nn\l_xref_curr_name_tlp}
\cs_set_nopar:Npn \getname{\xref_get_value:nn{name}}

\xref_deferred_new:nn {page}{\thepage}
\cs_set_nopar:Npn \getpage{\xref_get_value:nn{page}}

\xref_deferred_new:nn {valuepage}{\number\value{page}}
\cs_set_nopar:Npn \getvaluepage{\xref_get_value:nn{valuepage}}

\cs_set_eq:NN \setlabel \xref_set_label:n



\ExplSyntaxOff
\begin{document}
\AUTHOR{Will~Robertson}



\pagenumbering{roman}

Text\setname{This is a name}\setlabel{testlabel1}.  More
text\setname{This is another name}\setlabel{testlabel2}. \clearpage

Text\setname{This is a third name}\setlabel{testlabel3}. More
text\setname{Hello World!}\setlabel{testlabel4}. \clearpage



\pagenumbering{arabic}

Text\setname{Name 5}\setlabel{testlabel5}. More text\setname{Name
  6}\setlabel{testlabel6}. \clearpage

Text\setname{Name 7}\setlabel{testlabel7}. More text\setname{Name
  8}\setlabel{testlabel8}. \clearpage



\START

\def \TMP #1 {
  \TEST{test #1}{
    \TYPE{name: \getname{testlabel#1}}
    \TYPE{page: \getpage{testlabel#1}}
    \TYPE{valuepage: \getvaluepage{testlabel#1}}
  }
}

\TMP 1
\TMP 2
\TMP 3
\TMP 4
\TMP 5
\TMP 6
\TMP 7

\END
