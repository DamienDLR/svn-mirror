%
% Copyright (C) 2009 LaTeX3 Project
% 
\documentclass{minimal}
\input{regression-test}

\RequirePackage{l3tlp}


\begin{document}
\START
\AUTHOR{Will~Robertson}



% tests in this file fail with pdftex older than x (version 120 at least)
% first one just comes out wrong, the other end up in an close loop
%
% so I moved all of them to a single file for now - frank
%


\TESTEXP{map_break~function}{
  \tlp_map_function:NN \l_tmpa_tlp {\tlp_tmp:n}  
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% tmp measure ....!

\ifnum \pdftexversion > 120 \relax % those tests don't work with old pdftex


\tlp_set:Nn \l_tmpa_tlp {a{bb}cdzyx\ERROR\par ##}
\TEST{if_in~(T/T/T/F)}{
  \tlp_if_in:NnTF \l_tmpa_tlp {cdz}    {\TRUE} {\FALSE}
  \tlp_if_in:NnTF \l_tmpa_tlp {\ERROR} {\TRUE} {\FALSE}
  \tlp_if_in:NnTF \l_tmpa_tlp {\par}   {\TRUE} {\FALSE}
  \tlp_if_in:NnTF \l_tmpa_tlp {abb}    {\TRUE} {\FALSE}
  \SEPARATOR
  \tlp_if_in:NnFT \l_tmpa_tlp {cdz}    {\FALSE} {\TRUE} 
  \tlp_if_in:NnFT \l_tmpa_tlp {\ERROR} {\FALSE} {\TRUE} 
  \tlp_if_in:NnFT \l_tmpa_tlp {\par}   {\FALSE} {\TRUE} 
  \tlp_if_in:NnFT \l_tmpa_tlp {abb}    {\FALSE} {\TRUE} 
  \SEPARATOR
  \tlp_if_in:NnT \l_tmpa_tlp {cdz}    {\TRUE} 
  \tlp_if_in:NnT \l_tmpa_tlp {\ERROR} {\TRUE} 
  \tlp_if_in:NnT \l_tmpa_tlp {\par}   {\TRUE} 
  \SEPARATOR
  \tlp_if_in:NnF \l_tmpa_tlp {abb}    {\FALSE}
  \SEPARATOR
  \SEPARATOR
  \tlp_if_in:cnTF {l_tmpa_tlp} {cdz}    {\TRUE} {\FALSE}
  \tlp_if_in:cnTF {l_tmpa_tlp} {\ERROR} {\TRUE} {\FALSE}
  \tlp_if_in:cnTF {l_tmpa_tlp} {\par}   {\TRUE} {\FALSE}
  \tlp_if_in:cnTF {l_tmpa_tlp} {abb}    {\TRUE} {\FALSE}
  \SEPARATOR  
  \tlp_if_in:cnFT {l_tmpa_tlp} {cdz}    {\FALSE} {\TRUE} 
  \tlp_if_in:cnFT {l_tmpa_tlp} {\ERROR} {\FALSE} {\TRUE} 
  \tlp_if_in:cnFT {l_tmpa_tlp} {\par}   {\FALSE} {\TRUE} 
  \tlp_if_in:cnFT {l_tmpa_tlp} {abb}    {\FALSE} {\TRUE} 
  \SEPARATOR   
  \tlp_if_in:cnT {l_tmpa_tlp }{cdz}    {\TRUE} 
  \tlp_if_in:cnT {l_tmpa_tlp }{\ERROR} {\TRUE} 
  \tlp_if_in:cnT {l_tmpa_tlp }{\par}   {\TRUE} 
  \SEPARATOR  
  \tlp_if_in:cnF {l_tmpa_tlp }{abb}    {\FALSE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\tlp_set:Nn \l_tmpa_tlp {a{bb}cdzyx\ERROR\par ## cdzyx}

\TEST{replace_in}{
  \tlp_replace_in:Nnn \l_tmpa_tlp {cdz} {cc~dd~zz}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_replace_in:cnn {l_tmpa_tlp} {yx} {yy~xx}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
}

\TEST{greplace_in}{
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_in:Nnn \l_tmpa_tlp {cdz} {cc~dd~zz}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_in:cnn {l_tmpa_tlp} {yx} {yy~xx}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
}

\TEST{replace_all_in}{
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_replace_all_in:Nnn \l_tmpa_tlp {z} {{Z}}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_replace_all_in:cnn {l_tmpa_tlp} {y} {{Y}}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
}

\TEST{greplace_all_in}{
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_all_in:Nnn \l_tmpa_tlp {z} {{Z}}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_all_in:cnn {l_tmpa_tlp} {y} {{Y}}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
}

\TEST{greplace_all_in~#~and~par}{
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_all_in:Nnn \l_tmpa_tlp {\ERROR} {=/err=}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
  \tlp_greplace_all_in:Nnn \l_tmpa_tlp {\par} {~/par\par/par~}
  \TYPE { \tlp_to_str:N \l_tmpa_tlp }
}
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
