% Copyright (C) 2010 The LaTeX3 Project

\documentclass{minimal}
\input{regression-test}

\RequirePackage{expl3}

\begin{document}
\START
\AUTHOR{LaTeX3 Project}
\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Creating~new~fps}{ % 1
 \fp_new:N  \l_A_fp
 \fp_new:c  { l_A_fp }
 \fp_new:c  { l_B_fp }
 \fp_new:N  \g_A_fp
 \fp_new:c  { g_B_fp }
 \fp_show:N \l_A_fp
 \fp_show:N \g_A_fp
 \fp_show:N \l_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Set~fp}{ % 2
  \group_begin:
    \fp_set:Nn  \l_A_fp { 123.456 }
    \fp_set:Nn  \l_B_fp { -123.456 }
    \fp_gset:Nn \g_A_fp { 3 }
    \fp_gset:Nn \g_B_fp { -0.0 }
    \fp_show:N \l_A_fp
    \fp_show:c { l_B_fp }
    \fp_show:N \g_A_fp
    \fp_show:c { g_B_fp }
    \fp_set:Nn \l_A_fp { . }
    \fp_set:Nn \l_B_fp { - }
    \fp_show:N \l_A_fp
    \fp_show:c { l_B_fp }
    \fp_set:Nn \l_A_fp { -.001 }
    \fp_set:Nn \l_B_fp { }
    \fp_show:N \l_A_fp
    \fp_show:N \l_B_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \l_B_fp 
  \fp_show:N \g_A_fp
  \fp_show:N \g_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Set~fp~from~dimen}{ % 3
  \group_begin:
    \fp_set_from_dim:Nn  \l_A_fp { 1 pt }
    \fp_set_from_dim:Nn  \l_B_fp { \c_max_dim }
    \fp_gset_from_dim:Nn \g_A_fp { 1 sp }
    \fp_gset_from_dim:Nn \g_B_fp { 100 cm }
    \fp_show:N \l_A_fp
    \fp_show:c { l_B_fp }
    \fp_show:N \g_A_fp
    \fp_show:c { g_B_fp }
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \l_B_fp 
  \fp_show:N \g_A_fp
  \fp_show:N \g_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Zero~fp}{ % 4
  \fp_set:Nn  \l_A_fp { 1.234 }
  \fp_gset:Nn \g_A_fp { 1.234 }
  \group_begin:
    \fp_show:N \l_A_fp
    \fp_show:N \g_A_fp
    \fp_zero:N  \l_A_fp
    \fp_gzero:N \g_A_fp
    \fp_show:N \l_A_fp
    \fp_show:N \g_A_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \g_A_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Set~fps~equal}{ % 5
  \fp_set:Nn \l_A_fp  { 123.456 }
  \fp_gset:Nn \g_A_fp { 123.456 }
  \fp_zero:N  \l_B_fp 
  \fp_gzero:N \g_B_fp 
  \group_begin:
    \fp_show:N \l_B_fp
    \fp_show:N \g_B_fp
    \fp_set_eq:NN  \l_B_fp \l_A_fp
    \fp_gset_eq:NN \g_B_fp \g_A_fp
    \fp_show:N \l_B_fp
    \fp_show:N \g_B_fp
  \group_end:
  \fp_show:N \l_B_fp
  \fp_show:N \g_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\OMIT
  \fp_set:Nn    \l_A_fp { 123.456 }
  \fp_set_eq:NN \l_B_fp \c_zero_fp
  \fp_set_eq:NN \g_A_fp \c_infinity_fp
  \fp_set_eq:NN \g_B_fp \c_minus_infinity_fp
\TIMO

\TESTEXP{Test~if~fp~infinite~(expect~F/F/T/T)}{% 6
  \fp_if_infinite:NTF \l_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_infinite:NTF \l_B_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_infinite:NTF \g_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_infinite:NTF \g_B_fp { \TRUE } { \FALSE } \NEWLINE
}

\TESTEXP{Test~if~fp~positive~infinity~(expect~F/F/T/F)}{% 7
  \fp_if_plus_infinity:NTF \l_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_plus_infinity:NTF \l_B_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_plus_infinity:NTF \g_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_plus_infinity:NTF \g_B_fp { \TRUE } { \FALSE } \NEWLINE
}

\TESTEXP{Test~if~fp~negative~infinity~(expect~F/F/F/T)}{% 8
  \fp_if_minus_infinity:NTF \l_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_minus_infinity:NTF \l_B_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_minus_infinity:NTF \g_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_minus_infinity:NTF \g_B_fp { \TRUE } { \FALSE } \NEWLINE
}

\OMIT
  \fp_set:Nn    \l_A_fp { 123.456 }
  \fp_set_eq:NN \l_B_fp \c_zero_fp
  \fp_set_eq:NN \g_A_fp \c_infinity_fp
  \fp_set_eq:NN \g_B_fp \c_undefined_fp
\TIMO

\TESTEXP{Test~if~fp~undefined~(expect~F/F/F/T)}{% 9
  \fp_if_undefined:NTF \l_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_undefined:NTF \l_B_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_undefined:NTF \g_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_undefined:NTF \g_B_fp { \TRUE } { \FALSE } \NEWLINE
}

\TESTEXP{Test~if~fp~zero~(expect~F/T/F/F)}{% 10
  \fp_if_zero:NTF \l_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_zero:NTF \l_B_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_zero:NTF \g_A_fp { \TRUE } { \FALSE } \NEWLINE
  \fp_if_zero:NTF \g_B_fp { \TRUE } { \FALSE } \NEWLINE
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Convert~to~absolute~values}{ % 11
  \fp_set:Nn \l_A_fp  { -111.111 }
  \fp_set:Nn \l_B_fp  { 222.222 }
  \fp_gset:Nn \g_A_fp { -333.333 }
  \fp_gset:Nn \g_B_fp { 444.444 }
  \group_begin:
    \fp_abs:N  \l_A_fp
    \fp_abs:N  \l_B_fp
    \fp_gabs:N \g_A_fp
    \fp_gabs:N \g_B_fp
    \fp_show:N \l_A_fp
    \fp_show:N \l_B_fp
    \fp_show:N \g_A_fp
    \fp_show:N \g_B_fp
    \fp_abs:N  \l_A_fp
    \fp_abs:N  \l_B_fp
    \fp_gabs:N \g_A_fp
    \fp_gabs:N \g_B_fp
    \fp_show:N \l_A_fp
    \fp_show:N \l_B_fp
    \fp_show:N \g_A_fp
    \fp_show:N \g_B_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \l_B_fp
  \fp_show:N \g_A_fp
  \fp_show:N \g_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Convert~to~negative~values}{ % 12
  \fp_set:Nn \l_A_fp  { -111.111 }
  \fp_set:Nn \l_B_fp  { 222.222 }
  \fp_gset:Nn \g_A_fp { -333.333 }
  \fp_gset:Nn \g_B_fp { 444.444 }
  \group_begin:
    \fp_neg:N  \l_A_fp
    \fp_neg:N  \l_B_fp
    \fp_gneg:N \g_A_fp
    \fp_gneg:N \g_B_fp
    \fp_show:N \l_A_fp
    \fp_show:N \l_B_fp
    \fp_show:N \g_A_fp
    \fp_show:N \g_B_fp
    \fp_neg:N  \l_A_fp
    \fp_neg:N  \l_B_fp
    \fp_gneg:N \g_A_fp
    \fp_gneg:N \g_B_fp
    \fp_show:N \l_A_fp
    \fp_show:N \l_B_fp
    \fp_show:N \g_A_fp
    \fp_show:N \g_B_fp
    \fp_neg:N  \l_A_fp
    \fp_neg:N  \l_B_fp
    \fp_gneg:N \g_A_fp
    \fp_gneg:N \g_B_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \l_B_fp
  \fp_show:N \g_A_fp
  \fp_show:N \g_B_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Addition}{ % 13
  \group_begin:
    \fp_set:Nn \l_A_fp { 1 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { 100 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { 0.99 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { 0.01 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { -3000.123 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { 10000 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 99.123456 }
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { -40000 } 
    \fp_show:N \l_A_fp
    \fp_add:Nn \l_A_fp { 40000 } 
    \fp_show:N \l_A_fp 
    \fp_set:Nn \l_A_fp { 999999999.999999999 }
    \fp_show:N \l_A_fp 
    \fp_add:Nn \l_A_fp { 999999999.999999999 }
    \fp_show:N \l_A_fp 
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_show:N \l_A_fp 
    \fp_add:Nn \l_A_fp { 1.234 }
    \fp_show:N \l_A_fp 
    \fp_gset:Nn \g_A_fp { -0.001 }
    \fp_show:N  \g_A_fp
    \fp_gadd:Nn \g_A_fp { -0.999 }
    \fp_show:N  \g_A_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \g_A_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Subtraction}{ % 14
  \group_begin:
    \fp_set:Nn \l_A_fp { 1 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { 100 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { 0.99 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { 0.01 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { -3000.123 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { 10000 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 99.123456 }
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { -40000 } 
    \fp_show:N \l_A_fp
    \fp_sub:Nn \l_A_fp { 40000 } 
    \fp_set:Nn \l_A_fp { -999999999.999999999 }
    \fp_show:N \l_A_fp 
    \fp_sub:Nn \l_A_fp { 999999999.999999999 }
    \fp_show:N \l_A_fp 
    \fp_show:N \l_A_fp 
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_show:N \l_A_fp 
    \fp_sub:Nn \l_A_fp { -1.234 }
    \fp_show:N \l_A_fp 
    \fp_gset:Nn \g_A_fp { -0.001 }
    \fp_show:N  \g_A_fp
    \fp_gsub:Nn \g_A_fp { 0.999 }
    \fp_show:N  \g_A_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \g_A_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Multiplication}{ % 15
  \group_begin:
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_mul:Nn \l_A_fp { 0 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 0 }
    \fp_mul:Nn \l_A_fp { -5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 999999999 }
    \fp_mul:Nn \l_A_fp { 999999999 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 1.234 }
    \fp_mul:Nn \l_A_fp { 5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp {  1.234 }
    \fp_mul:Nn \l_A_fp { -5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_mul:Nn \l_A_fp {  5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_mul:Nn \l_A_fp { -5.678 }
    \fp_show:N \l_A_fp
    \fp_gset:Nn \g_A_fp { -1.234 }
    \fp_gmul:Nn \g_A_fp { -5.678 }
    \fp_show:N  \g_A_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \g_A_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Division}{ % 16
  \group_begin:
    \fp_set:Nn \l_A_fp { 1.234 }
    \fp_div:Nn \l_A_fp { 0 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 0 }
    \fp_div:Nn \l_A_fp { 1.234 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 0 }
    \fp_div:Nn \l_A_fp { 0 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 1.234 }
    \fp_div:Nn \l_A_fp { 5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp {  1.234 }
    \fp_div:Nn \l_A_fp { -5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_div:Nn \l_A_fp {  5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { -1.234 }
    \fp_div:Nn \l_A_fp { -5.678 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 100000 }
    \fp_div:Nn \l_A_fp { 0.09 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { -0.0000001 }
    \fp_div:Nn \l_A_fp { 1000000 }
    \fp_show:N \l_A_fp
    \fp_set:Nn \l_A_fp { 100000 }
    \fp_div:Nn \l_A_fp { 0.00001 }
    \fp_show:N \l_A_fp
    \fp_gset:Nn \g_A_fp { -0.01 }
    \fp_gdiv:Nn \g_A_fp { 99 }
    \fp_show:N  \g_A_fp
  \group_end:
  \fp_show:N \l_A_fp
  \fp_show:N \g_A_fp
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\OMIT
  \tl_new:N \l_A_tl
  \tl_new:N \g_A_tl
\TIMO

\TEST{Transferring~to~tls}{% 17
  \tl_clear:N  \l_A_tl
  \tl_gclear:N \g_A_tl
  \group_begin:
    \fp_set:Nn \l_A_fp { }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { +1.23456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -1.23456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -0.0 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 987654321.123456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 1.1 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -22.22 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -22.22 }
    \fp_gto_tl:NN \l_A_fp \g_A_tl
    \tl_show:N \l_A_tl
  \group_end:
  \tl_show:N \l_A_tl
  \tl_show:N \g_A_tl
}

\TEST{Transferring~to~tls~without~removing~zeros}{% 18
  \tl_clear:N  \l_A_tl
  \tl_gclear:N \g_A_tl
  \group_begin:
    \keys_set:nn { fp } { remove-trailing-zeros = false }
    \fp_set:Nn \l_A_fp { }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { +1.23456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -1.23456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -0.0 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 987654321.123456789 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 1.1 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -22.22 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { -22.22 }
    \fp_gto_tl:NN \l_A_fp \g_A_tl
    \tl_show:N \l_A_tl
  \group_end:
  \tl_show:N \l_A_tl
  \tl_show:N \g_A_tl
}

\TEST{Transferring~with~truncation}{% 19
  \tl_clear:N  \l_A_tl
  \tl_gclear:N \g_A_tl
  \group_begin:
    \keys_set:nn { fp } { round-mode = truncate }
    \fp_set:Nn \l_A_fp { 987654321.123456789 }
    \keys_set:nn { fp } { precision = 10 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 9 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 8 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 7 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 6 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 5 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 4 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 3 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 2 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 1 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 0 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = -1 }
    \fp_gto_tl:NN \l_A_fp \g_A_tl
    \tl_show:N \l_A_tl
  \group_end:
  \tl_show:N \l_A_tl
  \tl_show:N \g_A_tl
}

\TEST{Transferring~with~rounding}{% 20
  \tl_clear:N  \l_A_tl
  \tl_gclear:N \g_A_tl
  \group_begin:
    \keys_set:nn { fp } { round-mode = half-from-zero }
    \fp_set:Nn \l_A_fp { 987654321.123456789 }
    \keys_set:nn { fp } { precision = 10 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 9 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 8 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 7 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 6 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 5 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 4 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 3 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 2 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 1 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 0 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = -1 }
    \fp_gto_tl:NN \l_A_fp \g_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 3 }
    \fp_set:Nn \l_A_fp { 999.9995 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 999.9985 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
  \group_end:
  \tl_show:N \l_A_tl
  \tl_show:N \g_A_tl
}

\TEST{Transferring~with~rounding~to~even}{% 21
  \tl_clear:N  \l_A_tl
  \tl_gclear:N \g_A_tl
  \group_begin:
    \keys_set:nn { fp } { round-mode = half-even }
    \fp_set:Nn \l_A_fp { 987654321.123456789 }
    \keys_set:nn { fp } { precision = 10 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 9 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 8 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 7 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 6 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 5 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 4 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 3 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 2 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 1 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 0 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = -1 }
    \fp_gto_tl:NN \l_A_fp \g_A_tl
    \tl_show:N \l_A_tl
    \keys_set:nn { fp } { precision = 3 }
    \fp_set:Nn \l_A_fp { 999.9995 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
    \fp_set:Nn \l_A_fp { 999.9985 }
    \fp_to_tl:NN \l_A_fp \l_A_tl
    \tl_show:N \l_A_tl
  \group_end:
  \tl_show:N \l_A_tl
  \tl_show:N \g_A_tl
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\END
