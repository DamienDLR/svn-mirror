
DISTRIB-DIR = ../../distrib

README = readme-ctan.txt

XBASE-DIR = xbase

XBASE-INS = \
	xbase.ins

XBASE-DTX = \
	xparse.dtx \
	template.dtx \
	ldcsetup.dtx

XBASE-TEST = \
	template-test.tex \
	template-test2.tex \
	tprestrict-test.tex \
  	xparse-test.tex

XBASE-PDF = \
	xparse.pdf \
	template.pdf \
	ldcsetup.pdf

XBASE-DERIVED = \
	xparse.sty \
	template.sty \
	ldcsetup.sty

XTHEOREM-DIR = xtheorem

XTHEOREM-INS = \
	xtheorem.ins

XTHEOREM-DTX = \
	xtheorem.dtx 

XTHEOREM-TEST = \
	xtheorem-test.tex 

XTHEOREM-PDF = \
	xtheorem.pdf 

XTHEOREM-DERIVED = \
	xtheorem.sty



all: distrib-ctan

tds-dirs:
	mkdir -p $(DISTRIB-DIR)
	mkdir -p $(DISTRIB-DIR)/xpackages
	mkdir -p $(DISTRIB-DIR)/xpackages-tds
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/doc
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/doc/latex
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/doc/latex/xpackages
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/source
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/source/latex
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/source/latex/xpackages
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/tex
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/tex/latex
	mkdir -p $(DISTRIB-DIR)/xpackages-tds/tex/latex/xpackages


tds-dirs-clean: tds-dirs
	rm -f $(DISTRIB-DIR)/xpackages-tds/doc/latex/xpackages/*
	rm -f $(DISTRIB-DIR)/xpackages-tds/source/latex/xpackages/*
	rm -f $(DISTRIB-DIR)/xpackages-tds/tex/latex/xpackages/*
	rm -f $(DISTRIB-DIR)/xpackages/*
	rm -f $(DISTRIB-DIR)/xpackages.zip
	rm -f $(DISTRIB-DIR)/xpackages.tds.zip

xbase-styles:
	cd $(XBASE-DIR) ;  tex $(XBASE-INS)

xbase-pdfs: xbase-styles
# three runs should suffice
	cd $(XBASE-DIR) ; for f in $(XBASE-DTX) ; do pdflatex $$f ; done 
	cd $(XBASE-DIR) ; for f in $(XBASE-DTX) ; do pdflatex $$f ; done 
	cd $(XBASE-DIR) ; for f in $(XBASE-DTX) ; do pdflatex $$f ; done 


xbase-distrib: tds-dirs xbase-pdfs
	cd $(XBASE-DIR) ; \
	cp $(XBASE-DERIVED) ../$(DISTRIB-DIR)/xpackages-tds/tex/latex/xpackages  ; \
	cp $(XBASE-DTX) $(XBASE-INS) $(XBASE-TEST) \
	  ../$(DISTRIB-DIR)/xpackages-tds/source/latex/xpackages ; \
	cp $(XBASE-PDF) ../$(DISTRIB-DIR)/xpackages-tds/doc/latex/xpackages ;\
	cp $(XBASE-PDF) $(XBASE-DTX) $(XBASE-INS) $(XBASE-TEST) ../$(DISTRIB-DIR)/xpackages


xtheorem-styles:
	cd $(XTHEOREM-DIR) ;  tex $(XTHEOREM-INS)

xtheorem-pdfs: xtheorem-styles
# three runs should suffice
	cd $(XTHEOREM-DIR) ; for f in $(XTHEOREM-DTX) ; do pdflatex $$f ; done 
	cd $(XTHEOREM-DIR) ; for f in $(XTHEOREM-DTX) ; do pdflatex $$f ; done 
	cd $(XTHEOREM-DIR) ; for f in $(XTHEOREM-DTX) ; do pdflatex $$f ; done 


xtheorem-distrib: tds-dirs xtheorem-pdfs
	cd $(XTHEOREM-DIR) ; \
	cp $(XTHEOREM-DERIVED) ../$(DISTRIB-DIR)/xpackages-tds/tex/latex/xpackages  ; \
	cp $(XTHEOREM-DTX) $(XTHEOREM-INS) $(XTHEOREM-TEST) \
	  ../$(DISTRIB-DIR)/xpackages-tds/source/latex/xpackages ; \
	cp $(XTHEOREM-PDF) ../$(DISTRIB-DIR)/xpackages-tds/doc/latex/xpackages ;\
	cp $(XTHEOREM-PDF) $(XTHEOREM-DTX) $(XTHEOREM-INS) $(XTHEOREM-TEST) ../$(DISTRIB-DIR)/xpackages



distrib: tds-dirs-clean xbase-distrib xtheorem-distrib 
	cp $(README) $(DISTRIB-DIR)/xpackages
	cp $(README) $(DISTRIB-DIR)/xpackages-tds/doc/latex/xpackages
	cd $(DISTRIB-DIR)/xpackages-tds ; zip -r ../xpackages.tds.zip * 
	cd $(DISTRIB-DIR) ; zip -r xpackages.zip xpackages xpackages.tds.zip 


xxbase-styles:
	cd xbase ; latex xbase.ins

xxbase-tds: tds-dirs xbase-docs
	cp xbase/*.sty ../../distrib/xpackages-tds/tex/latex/xpackages
	cd xbase ; cp $(XBASE-DTX) $(XBASE-INS) $(XBASE-TEST) \
	../../../distrib/xpackages-tds/source/latex/xpackages
	cd xbase ; cp $(XBASE-PDF) ../../../distrib/xpackages-tds/doc/latex/xpackages

xxbase-ctan: xbase-docs tds-dirs
	cd xbase ; cp $(XBASE-DTX) $(XBASE-INS) $(XBASE-TEST) $(XBASE-PDF)  \
	   ../../../distrib/xpackages

xxbase-docs: xbase-styles 
	cd xbase ; pdflatex xparse.dtx ; pdflatex xparse.dtx ;\
	   	   pdflatex xparse.dtx ; pdflatex xparse.dtx;
	cd xbase ; pdflatex template.dtx ; pdflatex template.dtx ;\
	   	   pdflatex template.dtx ; pdflatex template.dtx;
	cd xbase ; pdflatex ldcsetup.dtx ; pdflatex ldcsetup.dtx ;\
	   	   pdflatex ldcsetup.dtx ; pdflatex ldcsetup.dtx;


distrib-tds: tds-dirs-clean xbase-tds xbase-ctan
	cp  $(README) ../../distrib/xpackages-tds/doc/latex/xpackages
	cd ../../distrib/xpackages-tds ; zip -r ../xpackages.tds.zip *

distrib-ctan: distrib-tds
	cp  $(README) ../../distrib/xpackages
	cd ../../distrib/ ; zip -r xpackages.zip xpackages xpackages.tds.zip

