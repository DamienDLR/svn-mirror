%
% Copyright (C) 2010 LaTeX3 Project
% 

\documentclass{minimal}
\input{regression-test}

\RequirePackage{xcoffins}

\begin{document}
\START
\AUTHOR{Frank Mittelbach}
\ExplSyntaxOn

\OMIT
\TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Testing~ new~ coffins}{
  \coffin_new:N \aaa
  \coffin_show_poles:N \aaa
  \box_new:N \xxx
  \coffin_add_struture_if_needed:N \xxx
  \coffin_show_poles:N \xxx
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Setting~ coffin~ poles}{
  \coffin_set_pole_coordinates:Nnnn \aaa {h} {test} {1pt}
  \coffin_show_poles:N \aaa
}

\OMIT
% ensure defaults are on top-level
\coffin_set_poles_to_default:N \aaa
\TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Setting~ coffin~ poles~ (2)}{
  \coffin_set_pole_coordinates:Nnnn \aaa {v} {test1} {1pt}
  \coffin_set_pole_coordinates:Nnnn \aaa {h} {test1} {2pt}
  \coffin_set_pole_safe:Nnnn       \aaa  {v} {test2}  {5pt}
  \coffin_set_pole_safe:Nnnn       \aaa  {h} {test2}  {-5pt}
  \coffin_adjust_pole_safe:Nnnn    \aaa {v} {c}   {-1pt}
  \coffin_show_poles:N \aaa
% works
  \box_new:N \yyy
  \coffin_set_pole_safe:Nnnn       \yyy {h} {onbox1} {5pt}
  \coffin_show_poles:N \yyy
% generates missing pole error
  \box_new:N \zzz
  \coffin_adjust_pole_safe:Nnnn    \zzz {h} {onbox2} {-5pt}
  \coffin_show_poles:N \zzz
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Retrieving~ coffin~ poles~ (1)}{
  \coffin_get_pole_coordinates:NnnN \aaa {h}{b} \l_result_tl
  \tl_show:N  \l_result_tl
% was locally added so error ...
  \coffin_get_pole_coordinates:NnnN \aaa {v}{test1} \l_result_tl
  \tl_show:N  \l_result_tl
% works as the initial assignment to the prop
% is be global
  \coffin_get_pole_coordinates:NnnN \xxx {h}{c} \l_result_tl
  \tl_show:N  \l_result_tl
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Equating~ coffins}{
   \sbox \aaa {A}
   \sbox \zzz {Z}
   \coffin_show_poles:N \zzz
   \box_show:N \zzz
   \coffin_set_pole_coordinates:Nnnn \aaa {h}{test1} {1pt-1pt}
   \coffin_set_pole_coordinates:Nnnn \aaa {v}{test1} {2pt - \wd #1}
   \coffin_set_eq:NN \zzz \aaa
   \coffin_show_poles:N \zzz
% \zzz = A \aaa = A
   \box_show:N \zzz
   \box_show:N \aaa
   \coffin_set_eq_clear:NN \xxx \zzz
   \coffin_show_poles:N \xxx
% now \zzz has the default poles again
   \coffin_show_poles:N \zzz
% \xxx = A \zzz = void
   \box_show:N \xxx
   \box_show:N \zzz
}

\OMIT
  \coffin_new:N \bbb
  \coffin_new:N \ccc
 \TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Prettyprinting~ or~ horrorprinting}{
  \sbox \bbb {B}
  \sbox \ccc{ \coffin_print_pole_values:Nn \bbb {~|~} }
\showboxdepth 9999
\showboxbreadth 9999
  \box_show:N \ccc
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}

\END
