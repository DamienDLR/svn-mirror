%
% Copyright (C) 2010 LaTeX3 Project
% 

\documentclass{minimal}
\input{regression-test}

\RequirePackage{xcoffins}

\begin{document}
\START
\AUTHOR{Frank Mittelbach}
\ExplSyntaxOn

\OMIT
\TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Testing~ new~ coffins}{
  \coffin_new:N \aaa
  \coffin_show_handles:N \aaa
  \box_new:N \xxx
  \coffin_add_struture_if_needed:N \xxx
  \coffin_show_handles:N \xxx
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Setting~ coffin~ handles}{
% declaration has handles defined locally, so "test" will be the only one
  \coffin_set_handle_coordinates:Nnn \aaa {test} {{1pt}{2pt}}
  \coffin_show_handles:N \aaa
}

\OMIT
% ensure defaults are on top-level
\coffin_set_handles_to_default:N \aaa
\TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Setting~ coffin~ handles~ (2)}{
  \coffin_set_handle_coordinates:Nnn \aaa {test1} {{1pt}{2pt}}
  \coffin_set_handle_safe:Nnnn       \aaa {test2} {5pt} {-5pt}
  \coffin_adjust_handle_safe:Nnnn    \aaa {cc}   {-1pt} {-1pt}
  \coffin_show_handles:N \aaa
% works
  \box_new:N \yyy
  \coffin_set_handle_safe:Nnnn       \yyy {onbox1} {5pt} {-5pt}
  \coffin_show_handles:N \yyy
% generates missing handle error
  \box_new:N \zzz
  \coffin_adjust_handle_safe:Nnnn    \zzz {onbox2} {5pt} {-5pt}
  \coffin_show_handles:N \zzz
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Retrieving~ coffin~ handles~ (1)}{
  \coffin_get_handle_coordinates:NnN \aaa {Hr} \l_result_tl
  \tl_show:N  \l_result_tl
% was locally added so error ...
  \coffin_get_handle_coordinates:NnN \aaa {test1} \l_result_tl
  \tl_show:N  \l_result_tl
% works as the initial assignment to the prop
% is be global
  \coffin_get_handle_coordinates:NnN \xxx {cc} \l_result_tl
  \tl_show:N  \l_result_tl
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Equating~ coffins}{
   \sbox \aaa {A}
   \sbox \zzz {Z}
   \coffin_show_handles:N \zzz
   \box_show:N \zzz
   \coffin_set_handle_coordinates:Nnn \aaa {test1} {{1pt-1pt}{2pt - \wd #1}}
   \coffin_set_eq:NN \zzz \aaa
   \coffin_show_handles:N \zzz
% \zzz = A \aaa = A
   \box_show:N \zzz
   \box_show:N \aaa
   \coffin_set_eq_clear:NN \xxx \zzz
   \coffin_show_handles:N \xxx
% now \zzz has the default handles again
   \coffin_show_handles:N \zzz
% \xxx = A \zzz = void
   \box_show:N \xxx
   \box_show:N \zzz
}

\OMIT
  \coffin_new:N \bbb
  \coffin_new:N \ccc
 \TIMO

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{Prettyprinting~ or~ horrorprinting}{
  \sbox \bbb {B}
  \sbox \ccc{ \coffin_print_handle_values:Nn \bbb {~|~} }
\showboxdepth 9999
\showboxbreadth 9999
  \box_show:N \ccc
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{}{
}

\END
