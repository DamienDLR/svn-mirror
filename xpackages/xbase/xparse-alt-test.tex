% \iffalse
%% (C) Copyright 2000-2009  LaTeX3 Project
%%
%% It may be distributed and/or modified under the conditions of the
%% LaTeX Project Public License (LPPL), either version 1.3a of this
%% license or (at your option) any later version.  The latest version
%% of this license is in the file
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% This file is part of the ``xbase bundle'' (The Work in LPPL)
%% and all files in that bundle must be distributed together.
%%
%% The released version of this bundle is available from CTAN.
%%
%% -----------------------------------------------------------------------
%%
%% The development version of the bundle can be found at
%%
%%    http://www.latex-project.org/cgi-bin/cvsweb.cgi/
%%
%% for those people who are interested.
%%
%%%%%%%%%%%
%% NOTE: %%
%%%%%%%%%%%
%%
%%   Snapshots taken from the repository represent work in progress and may
%%   not work or may contain conflicting material!  We therefore ask
%%   people _not_ to put them into distributions, archives, etc. without
%%   prior consultation with the LaTeX Project Team.
%%
%% -----------------------------------------------------------------------
%%
%% $Id$
%%
% \fi
%

\documentclass{article}

\usepackage{xparse-alt}

\ExplSyntaxOn
% Make a showing utility.
\DeclareDocumentCommand \showcmd { m } {
  \cs_show:N #1
  \cs_show:c { \token_to_str:N #1 } 
}
\ExplSyntaxOff

% First, some simple checks that we are getting error messages as
% expected. Also checks that everything works without experimental 
% syntax.
\NewDocumentCommand \test { m } {Argument: #1}
\NewDocumentCommand \test { m } {Argument: #1} % ERROR!
\RenewDocumentCommand \testa { m } {Argument: #1} % ERROR!
\ProvideDocumentCommand \test { m } {Argument now: #1}
\showcmd \test

\begin{document}
% Now something a bit more complex
\ExplSyntaxOn
\DeclareDocumentCommand \test { o{default} o m } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test[text][more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { o o{default} m } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test[text][more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { o o{default} m } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[]{more text}\\
\test[][]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { d<> o m } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test<text>{more text}\\
\test<text>[more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { d<>{default} o{default-a} m } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test<text>{more text}\\
\test<text>[more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { s o m } {
  \IfBooleanTF {#1} {
    Argument~1:~Star.~
  }{
    Argument~1:~No~star.~
  }
  \IfNoValueTF {#2} {
    Argument~2:~No~value.~
  }{
    Argument~2:~#2.~
  }
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test*{more text}\\
\test*[more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { s t+ o m } {
  \IfBooleanTF {#1} {
    Argument~1:~Star.~
  }{
    Argument~1:~No~star.~
  }
  \IfBooleanTF {#2} {
    Argument~1:~Plus.~
  }{
    Argument~1:~No~plus.~
  }
  \IfNoValueTF {#3} {
    Argument~3:~No~value.~
  }{
    Argument~3:~#3.~
  }
  Argument~4:~#4.~
}
\ExplSyntaxOff

\noindent
\test{text}\\
\test[text]{more text}\\
\test*{more text}\\
\test*[more text]{even more text}\\
\test+{text}\\
\test+[text]{more text}\\
\test*+{more text}\\
\test*+[more text]{even more text}\\

\ExplSyntaxOn
\DeclareDocumentCommand \test { o m } {
  \cs_set:Nx \example_tmpa: {
    \IfNoValueTF {#1} {
      TRUE
    }{
      FALSE
    }
  }
  \example_tmpa:.~
  Argument~2:~#2.~
}
\ExplSyntaxOff

\noindent
\test[text]{more text} \\
\test{more text}

\DeclareDocumentCommand \test { OmM } {
  \IfNoValueTF {#1} {
    Argument~1:~No~value.~
  }{
    Argument~1:~#1.~
  }
  Argument~2:~#2.~
  Argument~3:~#3.~
}
\ExplSyntaxOff

\noindent
\test{text}{short text}\\
\test{text}{long \par text}\\

\test{long \par text}{text}\\ % ERROR
\test[long \par text]{text}{text}\\ 
\test[long \par text]{text}{long \par text}\\ 

\ExplSyntaxOn
\DeclareDocumentEnvironment { test } { m } {
  \noindent
  Argument:~#1.\\
}{
  Argument~still~around:~#1.
}
\ExplSyntaxOff

\begin{test}{text}
  Some text inside an environment.\\
\end{test}

\end{document}
