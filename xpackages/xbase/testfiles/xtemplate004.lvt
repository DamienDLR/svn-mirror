%
% Copyright (C) 2009 LaTeX3 Project
% 
% contains all tests for which I think we should first have to decide if 
% something needs updating or not

\documentclass{minimal}
\input{regression-test}

\RequirePackage{xtemplate}

\begin{document}
\START
\AUTHOR{Frank Mittelbach}
\ExplSyntaxOn

\OMIT
\cs_new:Npn \ERROR {\typeout{~}\typeout{***~ ==>~TEST~ SHOWS~ ERRORS~<==~
***}\typeout{~}}
\cs_new:Npn \IMPROVE {\typeout{~}\typeout{^^J^^J***~ ==>~RESULT~ COULD~ BE~ IMPROVED~<==~
***}\typeout{~}}

\DeclareObjectType { test } {1}
\int_new:N \l_test_int
\TIMO



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Testing~incorrect~key~defaults}{
   \DeclareTemplateInterface{ test } {tname} {1} 
      {
        key  : choice {a, b} = c ,                         % wrong choice allowed
        key2 : boolean  = another dimension                % not detected  -
                                                           % probably ok though
      }   
   \ShowTemplateKeytypes { test }  { tname }
\ERROR
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Testing~incomplete~ key~ types}{
  \DeclareTemplateInterface{ test } {tname} {1} 
      {
        key1 : choice ,                                   % missing syntax component
        key2 : function ,                                 % not detected
        key3 : instance ,
      }   
  \ShowTemplateKeytypes { test }  { tname }
\ERROR
}
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Testing~key~names}{

  \DeclareTemplateInterface{ test } {tname} {1} 
      { key : integer,
        key : boolean                                      % double keys are
                                                           %  not detected
      }
\ERROR
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 4
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Testing~empty~ key~name}{
   \DeclareTemplateInterface{ test } {tname} {1}           % accepted, error?
      {  : tokenlist = foo }

  \ShowTemplateKeytypes { test }  { tname }               
  \ShowTemplateDefaults { test }  { tname }               
\ERROR
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 4
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\TEST{Testing~code~interface~var~assignments}{

  \DeclareTemplateInterface{ test } {tname} {1}      
      { key 1 : tokenlist = hello,
        key 2 : tokenlist = huhu,
      }

  \DeclareTemplateCode{test} {tname} {1} {
        k e y 1 = \l_X_tl ,                       % using same var twice not detected
        k ey 2  = \l_X_tl ,                      
      }{ }                                        % missing \DoParameterAssignments
}
\ERROR % should it be check?

\END
