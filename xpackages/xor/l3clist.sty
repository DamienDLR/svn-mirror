% $Id$
%
% tmp file that needs folding back to expl3
%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{l3clist}
          [2004/09/21 v1.0a L3 Experimental comma separated lists and
          other updates]
\RequirePackage{l3toks}
\RequirePackage{l3quark} 
\RequirePackage{l3expan}

\def_new:Npn \clist_new:N #1{\tlp_new:Nn #1{}}
\def_new:Npn \clist_new:c {\exp_args:Nc \clist_new:N}
\def_new:Npn \clist_new:O {\exp_args:No \clist_new:N}
\let_new:NN \clist_clear:N \tlp_clear:N
\let_new:NN \clist_clear:c \tlp_clear:c
\let_new:NN \clist_gclear:N \tlp_gclear:N
\let_new:NN \clist_gclear:c \tlp_gclear:c
\let_new:NN \clist_clear_new:N \tlp_clear_new:N
\let_new:NN \clist_clear_new:c \tlp_clear_new:c
\let_new:NN \clist_gclear_new:N \tlp_gclear_new:N
\let_new:NN \clist_gclear_new:c \tlp_gclear_new:c
\let_new:NN \clist_empty_p:N \tlp_empty_p:N
\def_new:Npn \clist_empty:NTF #1{
   \if_meaning:NN#1\c_empty_tlp
     \exp_after:NN\use_choice_i:nn
   \else: \exp_after:NN\use_choice_ii:nn  \fi:}
\def_new:Npn \clist_empty:cTF {\exp_args:Nc\clist_empty:NTF}
\def_new:Npn \clist_empty:NF #1{
   \if_meaning:NN#1\c_empty_tlp \exp_after:NN\use_none:n
   \else: \exp_after:NN\use:n \fi:}
\def_new:Npn \clist_empty:cF {\exp_args:Nc\clist_empty:NF}
\def_new:Npn \clist_empty_err:N #1{\if_meaning:NN#1\c_empty_tlp
  \tlp_clear:N \l_testa_tlp % catch prefixes
  \err_latex_bug:n{Empty~clis~`\token_to_string:N#1'}\fi:}
\def_new:Npn \clist_get:NN #1{
  \clist_empty_err:N #1
  \exp_after:NN\clist_get_aux:w #1\q_stop}
\def_new:Npn \clist_get_aux:w  #1,
                #2\q_stop #3{\tlp_set:Nn #3{#1}}
\def_new:Npn \clist_get:cN {\exp_args:Nc \clist_get:NN}
\def_new:Npn \clist_pop_aux:nnNN #1#2#3{
  \clist_empty_err:N #3
  \exp_after:NN\clist_pop_aux:w #3\q_stop #1#2#3}
\def_new:Npn \clist_pop_aux:w  #1,
                #2\q_stop #3#4#5#6{#3#5{#2}#4#6{#1}}

\def_new:Npn \clist_put_aux:Nnn #1{
  \exp_after:NN\clist_put_aux:w #1\q_stop #1}
\def_new:Npn \clist_put_aux:w #1\q_stop #2#3#4{\tlp_set:Nn #2{#3#1#4}}

\def_new:Npn \clist_put_left:Nn #1#2{
        \clist_put_aux:Nnn #1{#2,}{}}
\def_new:Npn \clist_put_left:cn {\exp_args:Nc\clist_put_left:Nn}
\def_new:Npn \clist_put_left:No {\exp_args:NNo\clist_put_left:Nn}
\def_new:Npn \clist_put_left:Nx {\exp_args:Nnx\clist_put_left:Nn}
\def_new:Npn \clist_put_right:Nn #1#2{
        \clist_put_aux:Nnn #1{}{,#2}}
\def_new:Npn \clist_put_right:No {\exp_args:Nno\clist_put_right:Nn}
\def_new:Npn \clist_put_right:Nx {\exp_args:Nnx\clist_put_right:Nn}
\def_new:Npn \clist_gput_left:Nn {
   \clist_put_left:Nn}
\def_new:Npn \clist_gput_right:Nn {
   \clist_put_right:Nn}
\def_new:Npn \clist_gput_right:No {\exp_args:NNo \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:cn {\exp_args:Nc  \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:co {\exp_args:Nco \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:cc {\exp_args:Ncc \clist_gput_right:Nn}


\def:Npn \exp_args:NNC {\::N\::C\:::}
\def_new:Npn \clist_gput_right:NC {\exp_args:NNC \clist_gput_right:Nn}

\def_new:Npn \clist_gconcat:NNN #1#2#3{
   \l_tmpa_toks \exp_after:NN{#2}
   \l_tmpb_toks \exp_after:NN{#3}
   \gdef:Npx #1{\toks_use:N \l_tmpa_toks \toks_use:N \l_tmpb_toks}}
\def_new:Npn \clist_gconcat:ccc{\exp_args:Nccc\clist_gconcat:NNN}

\def_new:Npn \clist_if_in:NnTF #1#2{
  \def:Npn\tmp:w
      ##1 #2, ##2##3\q_stop{
        \if_meaning:NN\q_no_value##2
          \exp_after:NN\use_choice_ii:nn
        \else:
          \exp_after:NN\use_choice_i:nn
        \fi:
      }
  \exp_after:NN
  \tmp:w #1 #2, \q_no_value \q_stop}

\def_new:Npn \clist_if_in:coTF {\exp_args:Nco \clist_if_in:NnTF}
\def_new:Npn \clist_if_in:cnTF {\exp_args:Nc \clist_if_in:NnTF}

\let_new:NN \clist_push:Nn \clist_put_left:Nn
\let_new:NN \clist_push:No \clist_put_left:No
\let_new:NN \clist_push:cn \clist_put_left:cn
\def_new:Npn \clist_pop:NN {\clist_pop_aux:nnNN \tlp_set:Nn \tlp_set:Nn}
\def_new:Npn \clist_pop:cN {\exp_args:Nc \clist_pop:NN}
\let_new:NN \clist_gpush:Nn \clist_gput_left:Nn
\def_new:Npn \clist_gpush:No {\exp_args:NNo \clist_gpush:Nn}
\def_new:Npn \clist_gpush:cn {\exp_args:Nc \clist_gpush:Nn}
\def_new:Npn \clist_gpop:NN {\clist_pop_aux:nnNN \tlp_gset:Nn \tlp_set:Nn}
\def_new:Npn \clist_gpop:cN {\exp_args:Nc \clist_gpop:NN}
\let_new:NN \clist_top:NN \clist_get:NN
\let_new:NN \clist_top:cN \clist_get:cN

\let_new:NN \clist_set_eq:NN \let:NN
\let_new:NN \clist_gset_eq:NN \glet:NN
\def_new:Npn \clist_gset_eq:cN {\exp_args:Nc \clist_gset_eq:NN}

% bug fix
\def:Npn \seq_gput_left:Nn {
   \global\seq_put_left:Nn}
\def:Npn \seq_gput_right:Nn {
   \global\seq_put_right:Nn}

\def_new:Npn \num_new:N #1{\tlp_new:Nn #1{}}
\let_new:NN \num_gset_eq:NN \tlp_gset_eq:NN
\def_new:Npn \num_gset_eq:cN {\exp_args:Nc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:Nc {\exp_args:NNc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:cc {\exp_args:Ncc \num_gset_eq:NN}

\let_new:NN \num_gset:Nn \tlp_gset:Nn
\let_new:NN \num_gset:cn \tlp_gset:cn


% new names?
\let_new:NN\seq_if_empty:NF \seq_empty:NF
\let_new:NN\seq_if_empty:cF \seq_empty:cF
\let_new:NN\seq_if_empty:cTF \seq_empty:cTF
\let_new:NN\seq_if_empty:NTF \seq_empty:NTF

\let_new:NN\tlp_use:c \use:c
\let_new:NN\num_use:c \use:c

%missing?
\let_new:NN\seq_set_eq:NN \tlp_set_eq:NN
\def_new:Npn \seq_set_eq:Nc {\exp_args:NNc \seq_set_eq:NN}
\def_new:Npn \seq_gput_right:Nc {\exp_args:NNc \seq_gput_right:Nn}
\def_new:Npn \seq_gset:cn {\exp_args:Nc \seq_gset:Nn}

\def_new:Npn \tlp_gset_eq:cN {\exp_args:Nc \tlp_gset_eq:NN}
\def_new:Npn \tlp_gset_eq:cc {\exp_args:Ncc \tlp_gset_eq:NN}

%questionable:

\let_new:NN\clist_use:n \use:n
\let_new:NN\clist_use:c \use:c



\endinput

\def_new:Npn \clist_map:NN #1#2{
    \def:Npn \clist_elt:w ##1\clist_elt_end: {#2{##1}}#1}
\def_new:Npn \clist_map_inline:Nn #1#2{
   \gdef:Npn \clist_elt:w ##1\clist_elt_end: {#2}#1}
\def_new:Npn \clist_map_inline:cn{\exp_args:Nc\clist_map_inline:Nn}



%% 
%%
%% End of file `l3clist.sty'.
