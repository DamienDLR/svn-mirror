% $Id$
%
% tmp file that needs folding back to expl3
%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{l3clist}
          [2004/09/21 v1.0a L3 Experimental comma separated lists and
          other updates]
\RequirePackage{l3toks}
\RequirePackage{l3quark} 
\RequirePackage{l3expan}

\def_new:Npn \clist_new:N #1{\tlp_new:Nn #1{}}
\def_new:Npn \clist_new:c {\exp_args:Nc \clist_new:N}
\def_new:Npn \clist_new:O {\exp_args:No \clist_new:N}

\let_new:NN \clist_clear:N \tlp_clear:N
\let_new:NN \clist_clear:c \tlp_clear:c
\let_new:NN \clist_gclear:N \tlp_gclear:N
\let_new:NN \clist_gclear:c \tlp_gclear:c
\let_new:NN \clist_clear_new:N \tlp_clear_new:N
\let_new:NN \clist_clear_new:c \tlp_clear_new:c
\let_new:NN \clist_gclear_new:N \tlp_gclear_new:N
\let_new:NN \clist_gclear_new:c \tlp_gclear_new:c

\let_new:NN \clist_empty_p:N \tlp_empty_p:N

\def_new:Npn \clist_if_empty:NTF #1{
   \if_meaning:NN#1\c_empty_tlp
     \exp_after:NN\use_choice_i:nn
   \else: \exp_after:NN\use_choice_ii:nn  \fi:}
\def_new:Npn \clist_if_empty:cTF {\exp_args:Nc\clist_if_empty:NTF}
\def_new:Npn \clist_if_empty:NF #1{
   \if_meaning:NN#1\c_empty_tlp \exp_after:NN\use_none:n
   \else: \exp_after:NN\use:n \fi:}
\def_new:Npn \clist_if_empty:cF {\exp_args:Nc\clist_if_empty:NF}
\def_new:Npn \clist_empty_err:N #1{\if_meaning:NN#1\c_empty_tlp
  \tlp_clear:N \l_testa_tlp % catch prefixes
  \err_latex_bug:n{Empty~clist~`\token_to_string:N#1'}\fi:}

\def_new:Npn \clist_get:NN #1{
  \clist_empty_err:N #1
  \exp_after:NN\clist_get_aux:w #1,\q_stop}
\def_new:Npn \clist_get_aux:w  #1,
                #2\q_stop #3{\tlp_set:Nn #3{#1}}
\def_new:Npn \clist_get:cN {\exp_args:Nc \clist_get:NN}
\def_new:Npn \clist_pop_aux:nnNN #1#2#3{
  \clist_empty_err:N #3
  \exp_after:NN\clist_pop_aux:w #3,\q_nil\q_stop #1#2#3}
\def_new:Npn \clist_pop_aux:w  #1,#2\q_stop #3#4#5#6{
   #4#6{#1}
   #3#5{#2}
   \ifx#5\q_nil
      #3#5{}
   \else
     \clist_pop_auxi:w #2 #3#5
   \fi
}
\def_new:Npn\clist_pop_auxi:w #1,\q_nil #2#3 
  {#2#3{#1}}




\iffalse %check
\def_new:Npn \clist_put_aux:Nnn #1{
  \exp_after:NN\clist_put_aux:w #1\q_stop #1}
\def_new:Npn \clist_put_aux:w #1\q_stop #2#3#4{\tlp_set:Nn #2{#3#1#4}}

\def_new:Npn \clist_put_left:Nn #1#2{
        \clist_if_empty:NTF#1
           {\tlp_set:Nn#1{#2}}
           {\clist_put_aux:Nnn #1{#2,}{}}
}
\def_new:Npn \clist_put_left:cn {\exp_args:Nc\clist_put_left:Nn}
\def_new:Npn \clist_put_left:No {\exp_args:NNo\clist_put_left:Nn}
\def_new:Npn \clist_put_left:Nx {\exp_args:Nnx\clist_put_left:Nn}

\def_new:Npn \clist_gput_left:Nn {
   \clist_put_left:Nn}
\fi

\def_new:Npn \clist_put_right:Nn #1#2{
        \clist_if_empty:NTF#1
           {\tlp_set:Nn#1{#2}}
           {\tlp_set:No#1{#1,#2}}}
\def_new:Npn \clist_put_right:No {\exp_args:Nno\clist_put_right:Nn}
\def_new:Npn \clist_put_right:Nx {\exp_args:Nnx\clist_put_right:Nn}

\def_new:Npn \clist_gput_right:Nn {
   \global\clist_put_right:Nn}
\def_new:Npn \clist_gput_right:No {\exp_args:NNo \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:cn {\exp_args:Nc  \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:co {\exp_args:Nco \clist_gput_right:Nn}
\def_new:Npn \clist_gput_right:cc {\exp_args:Ncc \clist_gput_right:Nn}



\def_new:Npn \clist_gput_right:NC {\exp_args:NNC \clist_gput_right:Nn}

\def_new:Npn \clist_gconcat:NNN #1#2#3{
   \l_tmpa_toks \exp_after:NN{#2}
   \l_tmpb_toks \exp_after:NN{#3}
   \gdef:Npx #1{
       \toks_use:N \l_tmpa_toks 
       \ifx \l_tmpa_toks \c_empty_toks \else
         \ifx \l_tmpb_toks \c_empty_toks \else
           ,
       \fi \fi
       \toks_use:N \l_tmpb_toks}
}
\def_new:Npn \clist_gconcat:NNc{\exp_args:Nnnc\clist_gconcat:NNN}
\def_new:Npn \clist_gconcat:ccc{\exp_args:Nccc\clist_gconcat:NNN}

%correct? check
\def_new:Npn \clist_if_in:NnTF #1#2{
  \def:Npn\tmp:w
      ##1 ,#2, ##2##3\q_stop{
        \if_meaning:NN\q_no_value##2
          \exp_after:NN\use_choice_ii:nn
        \else:
          \exp_after:NN\use_choice_i:nn
        \fi:
      }
  \exp_after:NN
  \tmp:w   \exp_after:NN ,
     #1, #2, \q_no_value \q_stop}

\def_new:Npn \clist_if_in:NoTF {\exp_args:NNo \clist_if_in:NnTF}
\def_new:Npn \clist_if_in:coTF {\exp_args:Nco \clist_if_in:NnTF}
\def_new:Npn \clist_if_in:cnTF {\exp_args:Nc \clist_if_in:NnTF}

\let_new:NN \clist_push:Nn \clist_put_left:Nn
\let_new:NN \clist_push:No \clist_put_left:No
\let_new:NN \clist_push:cn \clist_put_left:cn
\def_new:Npn \clist_pop:NN {\clist_pop_aux:nnNN \tlp_set:Nn \tlp_set:Nn}
\def_new:Npn \clist_pop:cN {\exp_args:Nc \clist_pop:NN}
\let_new:NN \clist_gpush:Nn \clist_gput_left:Nn
\def_new:Npn \clist_gpush:No {\exp_args:NNo \clist_gpush:Nn}
\def_new:Npn \clist_gpush:cn {\exp_args:Nc \clist_gpush:Nn}
\def_new:Npn \clist_gpop:NN {\clist_pop_aux:nnNN \tlp_gset:Nn \tlp_set:Nn}
\def_new:Npn \clist_gpop:cN {\exp_args:Nc \clist_gpop:NN}
\let_new:NN \clist_top:NN \clist_get:NN
\let_new:NN \clist_top:cN \clist_get:cN

\let_new:NN \clist_set_eq:NN \let:NN
\let_new:NN \clist_gset_eq:NN \glet:NN
\def_new:Npn \clist_gset_eq:cN {\exp_args:Nc \clist_gset_eq:NN}
\def_new:Npn \clist_gset_eq:Nc {\exp_args:NNc \clist_gset_eq:NN}
\def_new:Npn \clist_gset_eq:cc {\exp_args:Ncc \clist_gset_eq:NN}

\def_new:Npn \clist_map:NN #1#2{
   \clist_if_empty:NF #1
     {
      \def\clist_map_aux:w ##1,{
          \ifx\clist_map_aux:w ##1
          \else
            #2{##1}
            \expandafter\clist_map_aux:w
          \fi }
      \expandafter\clist_map_aux:w #1,\clist_map_aux:w,
     }
}
\def_new:Npn \clist_map_inline:Nn #1#2{
     \def\clist_funct:n ##1{#2}
     \clist_map:NN #1 \clist_funct:n
}

\def_new:Npn \clist_map_inline:cn {\exp_args:Nc \clist_map_inline:Nn}


\let_new:NN\clist_use:n \use:n
\let_new:NN\clist_use:c \use:c



%%%%%%%%%%%%%%%%%%%
%%% exp module
%%%%%%%%%%%%%%%%%%%

\def:Npn \exp_args:NNC {\::N\::C\:::}
\def:Npn \exp_args:Nnnc {\::n\::n\::c\:::}

%%%%%%%%%%%%%%%%%%%
%%% seq module
%%%%%%%%%%%%%%%%%%%

% bug fix
\def:Npn \seq_gput_left:Nn {
   \global\seq_put_left:Nn}
\def:Npn \seq_gput_right:Nn {
   \global\seq_put_right:Nn}

%missing?
\let_new:NN\seq_set_eq:NN \tlp_set_eq:NN
\def_new:Npn \seq_set_eq:Nc {\exp_args:NNc \seq_set_eq:NN}
\def_new:Npn \seq_gput_right:Nc {\exp_args:NNc \seq_gput_right:Nn}
\def_new:Npn \seq_gset:cn {\exp_args:Nc \seq_gset:Nn}


%%%%%%%%%%%%%%%%%%%
%%% num module
%%%%%%%%%%%%%%%%%%%

\def_new:Npn \num_new:N #1{\tlp_new:Nn #1{0}}
\let_new:NN \num_gset_eq:NN \tlp_gset_eq:NN
\def_new:Npn \num_gset_eq:cN {\exp_args:Nc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:Nc {\exp_args:NNc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:cc {\exp_args:Ncc \num_gset_eq:NN}


\def_new:Npn \num_gclear:N #1 {\tlp_gset:Nn #1{0}}
\def_new:Npn \num_gclear:c {\exp_args:Nc \num_gclear:N}

% perhaps setting should be done using a counter locally?

\int_new:N \l_num_tmp_int

\def_new:Npn \num_set_aux:NNn #1#2#3{
  \int_set:Nn \l_num_tmp_int {#3}
  #1 #2{\int_use:N \l_num_tmp_int}
} 

\def_new:Npn \num_add_aux:NNn #1#2#3{
  \int_set:Nn \l_num_tmp_int {#2}
  \int_add:Nn \l_num_tmp_int {#3}
  #1 #2{\int_use:N \l_num_tmp_int}
} 

\def_new:Npn \num_set:Nn  {\num_set_aux:NNn \tlp_set:No}
\def_new:Npn \num_gset:Nn {\num_set_aux:NNn \tlp_gset:No}

\def_new:Npn \num_add:Nn  {\num_add_aux:NNn \tlp_set:No}
\def_new:Npn \num_gadd:Nn {\num_add_aux:NNn \tlp_gset:No}

\def_new:Npn \num_gset:cn {\exp_args:Nc \num_gset:Nn}

% \begin{macro}{\num_gincr:N}
% \begin{macro}{\num_gincr:c}
%    Globally increment a ``number macro'' by one.
%    \begin{macrocode}
\def_new:Npn \num_gincr:N #1 {\num_gadd:Nn #1 \c_one}
\def_new:Npn \num_gincr:c {\exp_args:Nc\num_gincr:N}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
%
% \begin{macro}{\num_gdecr:N}
% \begin{macro}{\num_gdecr:c}
%    Globally decrement a ``number macro'' by one.
%    \begin{macrocode}
\def_new:Npn \num_gdecr:N #1 {\num_gadd:Nn #1 \c_minus_one}
\def_new:Npn \num_gdecr:c {\exp_args:Nc\num_gdecr:N}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\num_decr:N}
% \begin{macro}{\num_decr:c}
%     Decrement a ``number macro'' by one.
%    \begin{macrocode}
\def_new:Npn \num_decr:N #1 {\num_add:Nn #1 \c_minus_one}
\def_new:Npn \num_decr:c {\exp_args:Nc\num_decr:N}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%

\def_new:Npn \num_gzero:N #1 {\num_gset:Nn #1 0}

%%%%%%%%%%%%%%%%%%%
%%% int module
%%%%%%%%%%%%%%%%%%%

% provide setting to zero?
\def_new:Npn \int_zero:N  #1 {#1\c_zero}
\def_new:Npn \int_gzero:N #1 {\global#1\c_zero}
\def_new:Npn \int_gzero:c {\exp_args:Nc \int_gzero:N}


%%%%%%%%%%%%%%%%%%%
% tlp module
%%%%%%%%%%%%%%%%%%%
%missing?
\def_new:Npn \tlp_gset_eq:Nc {\exp_args:NNc \tlp_gset_eq:NN}
\def_new:Npn \tlp_gset_eq:cN {\exp_args:Nc  \tlp_gset_eq:NN}
\def_new:Npn \tlp_gset_eq:cc {\exp_args:Ncc \tlp_gset_eq:NN}

\def_new:Npn \tlp_if_eq:NNTF #1#2{
 \if_meaning:NN#1#2
    \exp_after:NN\use_choice_i:nn
 \else:
    \exp_after:NN\use_choice_ii:nn
 \fi:
}

\def_new:Npn \tlp_gset:cx {\exp_args:Nc \tlp_gset:Nn}


%%%%%%%%%%%%%%%%%%%
% new names?
%%%%%%%%%%%%%%%%%%%
\let_new:NN\seq_if_empty:NF \seq_empty:NF
\let_new:NN\seq_if_empty:cF \seq_empty:cF
\let_new:NN\seq_if_empty:cTF \seq_empty:cTF
\let_new:NN\seq_if_empty:NTF \seq_empty:NTF

\let_new:NN\num_use:N \use:n
\let_new:NN\tlp_use:c \use:c
\let_new:NN\num_use:c \use:c



%%%%%%%%%%%%%%%%%%%
% missing?
%%%%%%%%%%%%%%%%%%%

\def_new:Npn \let_new:cN {\exp_args:Nc \let_new:NN}




\endinput

\def_new:Npn \clist_map:NN #1#2{
    \def:Npn \clist_elt:w ##1\clist_elt_end: {#2{##1}}#1}
\def_new:Npn \clist_map_inline:Nn #1#2{
   \gdef:Npn \clist_elt:w ##1\clist_elt_end: {#2}#1}
\def_new:Npn \clist_map_inline:cn{\exp_args:Nc\clist_map_inline:Nn}



%% 
%%
%% End of file `l3clist.sty'.
