% \iffalse
%% File l3stuff.sty  Copyright 2004 Frank Mittelbach, LaTeX3 Project
%%
%% It may be distributed and/or modified under the conditions of the
%% LaTeX Project Public License (LPPL), either version 1.3a of this
%% license or (at your option) any later version.  The latest version
%% of this license is in the file
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% This file is part of the ``xor bundle'' (The Work in LPPL)
%% and all files in that bundle must be distributed together.
%%
%% The released version of this bundle is available from CTAN.
%%
%% -----------------------------------------------------------------------
%%
%% The development version of the bundle can be found at
%%
%%    http://www.latex-project.org/cgi-bin/cvsweb.cgi/
%%
%% for those people who are interested.
%%
%%%%%%%%%%%
%% NOTE: %%
%%%%%%%%%%%
%%
%%   Snapshots taken from the repository represent work in progress and may
%%   not work or may contain conflicting material!  We therefore ask
%%   people _not_ to put them into distributions, archives, etc. without
%%   prior consultation with the LaTeX Project Team.
%%
%% -----------------------------------------------------------------------
%%
\def\next#1: #2.sty,v #3 #4 #5 #6 #7$#8{%
  \def\fileversion{#3}%
  \def\filedate{#4}%
  \ProvidesPackage{#2}[#4 #3 #5 #6]%
}
\next$Id$
          {}
% \fi
%
%
% tmp file that needs folding back to expl3
%

\NeedsTeXFormat{LaTeX2e}
\RequirePackage{l3toks}
\RequirePackage{l3quark}
\RequirePackage{l3expan}







%%%%%%%%%%%%%%%%%%%
%%% clist module
%%%%%%%%%%%%%%%%%%%


\iffalse %check
\def_new:Npn \clist_put_aux:Nnn #1{
  \exp_after:NN\clist_put_aux:w #1\q_stop #1}
\def_new:Npn \clist_put_aux:w #1\q_stop #2#3#4{\tlp_set:Nn #2{#3#1#4}}

\def_new:Npn \clist_put_left:Nn #1#2{
        \clist_if_empty:NTF#1
           {\tlp_set:Nn#1{#2}}
           {\clist_put_aux:Nnn #1{#2,}{}}
}
\def_new:Npn \clist_put_left:cn {\exp_args:Nc\clist_put_left:Nn}
\def_new:Npn \clist_put_left:No {\exp_args:NNo\clist_put_left:Nn}
\def_new:Npn \clist_put_left:Nx {\exp_args:Nnx\clist_put_left:Nn}

\def_new:Npn \clist_gput_left:Nn {
   \clist_put_left:Nn}
\fi


\def:Npn \clist_use:N #1 {
  \if_meaning:NN #1 \scan_stop:
% this is not a clist (could be a misgenerated csname)
     \ERROR-clist
  \else:
    #1
  \fi:
}


\let_new:NN \clist_if_eq:NNTF \tlp_if_eq:NNTF



%%%%%%%%%%%%%%%%%%%
%%% box module
%%%%%%%%%%%%%%%%%%%

\let_new:NN \box_new:N \newbox
\def_new:Npn \box_new:c {\exp_args:Nc \box_new:N}

\def_new:Npn \box_if_empty:NTF #1{
  \tex_ifvoid:D #1
    \exp_after:NN \use_arg_i:nn
  \else:
    \exp_after:NN \use_arg_ii:nn
  \fi:
}
\def_new:Npn \box_if_empty:cTF {\exp_args:Nc \box_if_empty:NTF}
\def_new:Npn \box_if_empty:NT #1{
  \tex_ifvoid:D #1
    \exp_after:NN \use_arg_ii:nn
  \fi:
  \use_none:n
}
\def_new:Npn \box_if_empty:cT {\exp_args:Nc \box_if_empty:NT}
\def_new:Npn \box_if_empty:NF #1{
  \tex_ifvoid:D #1
    \exp_after:NN \use_none:n
  \else:
    \exp_after:NN \use_arg_i:n
  \fi:
}
\def_new:Npn \box_if_empty:cF {\exp_args:Nc \box_if_empty:NF}


\def_new:Npn \box_set_eq:NN #1#2
   {\tex_setbox:D #1 \tex_box:D #2}
\def_new:Npn \box_set_eq:cN {\exp_args:Nc \box_set_eq:NN}
\def_new:Npn \box_set_eq:Nc {\exp_args:NNc \box_set_eq:NN}
\def_new:Npn \box_set_eq:cc {\exp_args:Ncc \box_set_eq:NN}

\def_new:Npn \box_gset_eq:NN
   {\pref_global:D\box_set_eq:NN}
\def_new:Npn \box_gset_eq:cN {\exp_args:Nc \box_gset_eq:NN}
\def_new:Npn \box_gset_eq:Nc {\exp_args:NNc \box_gset_eq:NN}
\def_new:Npn \box_gset_eq:cc {\exp_args:Ncc \box_gset_eq:NN}

\def_new:Npn \box_clear:N #1{\box_set_eq:NN #1 \c_void_box }
\def_new:Npn \box_gclear:N {\pref_global:D\box_clear:N}

%% Do these names make sense? MH

\let_new:NN \box_ht:N \tex_ht:D
\let_new:NN \box_dp:N \tex_dp:D
\let_new:NN \box_wd:N \tex_wd:D

\def_new:Npn \box_ht:c {\exp_args:Nc \box_ht:N}
\def_new:Npn \box_dp:c {\exp_args:Nc \box_dp:N}
\def_new:Npn \box_wd:c {\exp_args:Nc \box_wd:N}

\let_new:NN \box_use_and_clear:N \tex_box:D
\let_new:NN \box_use:N \tex_copy:D

\def_new:Npn \box_use_and_clear:c {\exp_args:Nc \box_use_and_clear:N}
\def_new:Npn \box_use:c {\exp_args:Nc \box_use:N}

\let:NN \box_show:N \tex_showbox:D
\def_new:Npn \box_show:c {\exp_args:Nc \box_show:N}

\let:NN \c_void_box \voidb@x
%%% end MH addition

\let_new:NN \l_tmpa_box \@tempboxa
%%\box_new:N\l_tmpa_box
\box_new:N\l_tmpb_box

%% vertical

\def_long_new:Npn \vbox_set:Nn #1#2
   {\tex_setbox:D #1 \tex_vbox:D {#2}}

\def_new:Npn \vbox_gset:Nn
   {\pref_global:D \vbox_set:Nn}

\def_new:Npn \vbox_gset:cn {\exp_args:Nc \vbox_gset:Nn}

\def_long_new:Npn \vbox_set_to_ht:Nnn #1#2#3
   {\tex_setbox:D #1 \tex_vbox:D to #2 {#3}}

\def_new:Npn \vbox_gset_to_ht:Nnn
   {\pref_global:D \vbox_set_to_ht:Nnn }

\def_new:Npn \vbox_gset_to_ht:ccn {\exp_args:Ncc \vbox_gset_to_ht:Nnn}

\def_new:Npn \vbox_set_inline_begin:N  #1
   {\tex_setbox:D #1 \tex_vbox:D \bgroup }
\let_new:NN \vbox_set_inline_end: \egroup    % or all the same? eg: \box_inline_end:

\def_new:Npn \vbox_gset_inline_begin:N
   {\pref_global:D \vbox_set_inline_begin:N}
\let_new:NN \vbox_gset_inline_end: \egroup

\def_long_new:Npn \vbox_to_ht:nn #1#2
   {\tex_vbox:D to #1 {#2}}

\def_long_new:Npn \vbox_to_zero:n #1
   {\tex_vbox:D to \c_zero {#1}}

\def_new:Npn \vbox_set_split_to_ht:nnn #1#2#3{
  \tex_setbox:D #1 \tex_vsplit:D #2 to #3
}

% unpacking a box
\let_new:NN \vbox_unpack:N \tex_unvcopy:D
\let_new:NN \vbox_unpack_and_clear:N \tex_unvbox:D

%% horizontal

\def_long_new:Npn \hbox_set:Nn #1#2
   {\tex_setbox:D #1 \tex_hbox:D {#2}}

\def_long_new:Npn \hbox_set_to_wd:Nnn #1#2#3
   {\tex_setbox:D #1 \tex_hbox:D to #2 {#3}}

\def_long_new:Npn \hbox_gset:Nn
   {\pref_global:D \hbox_set:Nn}

\def_new:Npn \hbox_to_wd:nn {\tex_hbox:D to} % use args as above??

\def_new:Npn \hbox_set_inline_begin:N #1
   { \tex_setbox:D #1 \tex_hbox:D \bgroup }
\let_new:NN \hbox_set_inline_end: \egroup    % or all the same? eg: \box_inline_end:

\def_new:Npn \hbox_gset_inline_begin:N
   {\pref_global:D \hbox_set_inline_begin:N}
\let_new:NN \hbox_gset_inline_end: \egroup


% unpacking a box
\let_new:NN \hbox_unpack:N \tex_unhcopy:D
\let_new:NN \hbox_unpack_and_clear:N \tex_unhbox:D

%%% xo-or.sty:1528: \setbox\z@\vsplit\c_twohundred_fifty_five to\l_tmpa_dim
%%% xo-or.dtx:222:  \global\setbox\removed@guard@box\lastbox}

%% it probably should be  \vbox_set:nn not  \vbox_set:Nn  as we can
%% have a number as the first arg ... do do we argue that this is not
%% supported on this level?

%%%%%%%%%%%%%%%%%%%
%%% exp module
%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%
%%% seq module
%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%
%%% num module
%%%%%%%%%%%%%%%%%%%

\let_new:NN \num_gset_eq:NN \tlp_gset_eq:NN
\def_new:Npn \num_gset_eq:cN {\exp_args:Nc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:Nc {\exp_args:NNc \num_gset_eq:NN}
\def_new:Npn \num_gset_eq:cc {\exp_args:Ncc \num_gset_eq:NN}



%%%%%%%%%%%%%%%%%%%
%%% int module
%%%%%%%%%%%%%%%%%%%

% provide setting to zero?
\def_new:Npn \int_zero:N  #1 {#1\c_zero}
\def_new:Npn \int_gzero:N #1 {\global#1\c_zero}
\def_new:Npn \int_gzero:c {\exp_args:Nc \int_gzero:N}


%%%%%%%%%%%%%%%%%%%
% tlp module
%%%%%%%%%%%%%%%%%%%
%missing?
\def_new:Npn \tlp_gset_eq:Nc {\exp_args:NNc \tlp_gset_eq:NN}
\def_new:Npn \tlp_gset_eq:cN {\exp_args:Nc  \tlp_gset_eq:NN}
\def_new:Npn \tlp_gset_eq:cc {\exp_args:Ncc \tlp_gset_eq:NN}

\def_new:Npn \tlp_gset:cx {\exp_args:Ncx \tlp_gset:Nn}

\def_new:Npn \tlp_new:cn {\exp_args:Nc \tlp_new:Nn}

%%%%%%%%%%%%%%%%%%%
% new names?
%%%%%%%%%%%%%%%%%%%

\let_new:NN\tlp_use:c \use:c

%%%%%%%%%%%%%%%%%%%
% missing?
%%%%%%%%%%%%%%%%%%%

\def_new:Npn \let_new:cN {\exp_args:Nc \let_new:NN}

\def_new:Npn \glet:Nc {\exp_args:NNc \glet:NN}
\def_new:Npn \glet:cN {\exp_args:Nc \glet:NN}
\def_new:Npn \glet:cc {\exp_args:Ncc \glet:NN}

%%%%%%%%%%%%%%%%%%%
% maybe ...
%%%%%%%%%%%%%%%%%%%


\let_new:NN  \cs_show:N \tex_show:D
\def_new:Npn \cs_show:c {\exp_args:Nc \cs_show:N}

\let_new:NN \cs_meaning:N \tex_meaning:D
\def_new:Npn \cs_meaning:c {\exp_args:Nc \cs_meaning:N}

%%%%%%%%%%%%%%%%%%%
%%% prop module
%%%%%%%%%%%%%%%%%%%

\let:NN \prop_gset_eq:cc \glet:cc
\let:NN \prop_gset_eq:NN \glet:NN

%%%%%%%%%%%%%%%%%%%
% modes
%%%%%%%%%%%%%%%%%%%

\def_new:Npn \mode_vertical:TF {
  \tex_ifvmode:D
    \exp_after:NN \use_arg_i:nn
  \else:
    \exp_after:NN \use_arg_ii:nn
  \fi:}
\def_new:Npn \mode_vertical:T {
  \tex_ifvmode:D
    \exp_after:NN \use_arg_i:n
  \else:
    \exp_after:NN \use_none:n
  \fi:}
\def_new:Npn \mode_horizontal:TF {
  \tex_ifhmode:D
    \exp_after:NN \use_arg_i:nn
  \else:
    \exp_after:NN \use_arg_ii:nn
  \fi:}
\def_new:Npn \mode_horizontal:T {
  \tex_ifhmode:D
    \exp_after:NN \use_arg_i:n
  \else:
    \exp_after:NN \use_none:n
  \fi:}
\def_new:Npn \mode_inner:TF {
  \tex_ifinner:D
    \exp_after:NN \use_arg_i:nn
  \else:
    \exp_after:NN \use_arg_ii:nn
  \fi:}
\def_new:Npn \mode_math:TF {
  \scan_stop_if_begin_alignment:
  \tex_ifmmode:D
    \exp_after:NN \use_arg_i:nn
  \else:
    \exp_after:NN \use_arg_ii:nn
  \fi:}
% We test for empty list first as that is the rarest case
% of the two.
\def_new:Npn \scan_stop_if_begin_alignment: {
  \if_num:w \etex_lastnodetype:D = \c_minus_one
    \if_num:w \etex_currentgrouptype:D = \c_six
      \scan_stop:
  \fi: \fi: }

\endinput
