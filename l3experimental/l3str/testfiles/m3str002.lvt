%
% Copyright (C) 2011 LaTeX3 Project
%

\documentclass{minimal}
\input{regression-test}

\RequirePackage{l3str}

\begin{document}
\START
\AUTHOR{Bruno Le Floch}
\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{str_if_bytes}{
  \str_set:Nn \l_foo_str {abc~#\^^@\^^ff}
  \TYPE { \str_if_bytes:NTF \l_foo_str { TRUE } { \ERROR } }
  % Needs testing with LuaTeX or XeTeX!
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\char_set_catcode_other:N \^^c2
\char_set_catcode_other:N \^^83

\TEST{str_set_from_UTF_viii:Nn}{
  \str_set_convert:Nnn \l_tmpa_str { utf8 } { ^^c2 ^^83 }
  \str_if_eq:onTF \l_tmpa_str { ^^83 } { \TRUE } { \ERROR }
}

\TEST{str_to_UTF_viii:n}{
  \str_if_eq:xxTF
    { \str_bytes_convert:nnn { native } { utf8 } { ^^83 } }
    { ^^c2 ^^83 }
    { \TRUE } { \ERROR }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cs_set:Npn \test_tmp:w #1
  { #10 #11 #12 #13 #14 #15 #16 #17 #18 #19 #1A #1B #1C #1D #1E #1F }
\str_set:Nx \l_foo_str
  { \tl_map_function:nN {0123456789ABCDEF} \test_tmp:w }

\TEST{str_bytes_(un)escape_hexadecimal:n}{
  \str_set:Nx \l_bar_str
    { \exp_args:No \str_bytes_unescape_hexadecimal:n { \l_foo_str } }
  \TYPE { \l_bar_str }
  \str_if_eq:xxTF
    { \l_foo_str }
    { \exp_args:No \str_bytes_escape_hexadecimal:n { \l_bar_str } }
    { \TRUE } { \ERROR }
}
 % need to test on invalid input

\str_set:Nx \l_foo_str
  { \exp_args:No \str_bytes_unescape_hexadecimal:n { \l_foo_str } }
\TEST{str_bytes_(un)escape_name:n}{
  \str_set:Nx \l_bar_str
    { \exp_args:No \str_bytes_escape_name:n { \l_foo_str } }
  \TYPE { \l_bar_str }
  \str_if_eq:xxTF
    { \l_foo_str }
    { \exp_args:No \str_bytes_unescape_name:n { \l_bar_str } }
    { \TRUE } { \ERROR }
}
 % need to test on invalid input

\TEST{str_bytes_(un)escape_string:n}{
  \str_set:Nx \l_bar_str
    { \exp_args:No \str_bytes_escape_string:n { \l_foo_str } }
  \TYPE { \l_bar_str }
  \str_if_eq:xxTF
    { \l_foo_str }
    { \exp_args:No \str_bytes_unescape_string:n { \l_bar_str } }
    { \TRUE } { \ERROR }
}
 % need to test on invalid input

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST{str_bytes_percent_(en|de)code:n}{
  \str_set:Nx \l_bar_str
    { \exp_args:No \str_bytes_percent_encode:n { \l_foo_str } }
  \TYPE { \l_bar_str }
  \str_if_eq:xxTF
    { \l_foo_str }
    { \exp_args:No \str_bytes_percent_decode:n { \l_bar_str } }
    { \TRUE } { \ERROR }
}
 % need to test on invalid input

\END
